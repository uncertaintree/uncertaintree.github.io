<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Introduction to R: Session 04</title>
  <meta name="description" content="Introduction to R: Session 04" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Introduction to R: Session 04" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R: Session 04" />
  
  
  

<meta name="author" content="Holger Sennhenn-Reulen, Nordwestdeutsche Forstliche Versuchsanstalt (NW-FVA)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />










<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style_gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#working-with-real-data"><i class="fa fa-check"></i><b>1</b> Working with ‘real’ data</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#reproducible-data-management"><i class="fa fa-check"></i><b>1.1</b> Reproducible data management</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#preparatory-steps-prior-r"><i class="fa fa-check"></i><b>1.2</b> Preparatory steps prior R</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#variable-names"><i class="fa fa-check"></i><b>1.3</b> Variable names</a></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#preparatory-work-in-r"><i class="fa fa-check"></i><b>1.4</b> Preparatory Work in R</a></li>
<li class="chapter" data-level="1.5" data-path=""><a href="#read.table"><i class="fa fa-check"></i><b>1.5</b> <code>read.table()</code></a></li>
<li class="chapter" data-level="1.6" data-path=""><a href="#read.csv-and-read.csv2"><i class="fa fa-check"></i><b>1.6</b> <code>read.csv()</code> and <code>read.csv2()</code></a></li>
<li class="chapter" data-level="1.7" data-path=""><a href="#factors"><i class="fa fa-check"></i><b>1.7</b> Factors</a></li>
<li class="chapter" data-level="1.8" data-path=""><a href="#attach-subset-and-merge"><i class="fa fa-check"></i><b>1.8</b> <code>attach</code>, <code>subset</code> and <code>merge</code></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#descriptive-analysis-for-univariate-samples"><i class="fa fa-check"></i><b>2</b> Descriptive analysis for univariate samples</a>
<ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#continuously-scaled-variable"><i class="fa fa-check"></i><b>2.1</b> Continuously scaled variable</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path=""><a href="#location"><i class="fa fa-check"></i><b>2.1.1</b> Location</a></li>
<li class="chapter" data-level="2.1.2" data-path=""><a href="#exercises"><i class="fa fa-check"></i><b>2.1.2</b> Exercises</a></li>
<li class="chapter" data-level="2.1.3" data-path=""><a href="#scale-variation"><i class="fa fa-check"></i><b>2.1.3</b> Scale / variation</a></li>
<li class="chapter" data-level="2.1.4" data-path=""><a href="#exercises-1"><i class="fa fa-check"></i><b>2.1.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#categorically-scaled-variables"><i class="fa fa-check"></i><b>2.2</b> Categorically scaled variables</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path=""><a href="#one-dimensional"><i class="fa fa-check"></i><b>2.2.1</b> One dimensional:</a></li>
<li class="chapter" data-level="2.2.2" data-path=""><a href="#two-dimensional"><i class="fa fa-check"></i><b>2.2.2</b> Two dimensional</a></li>
<li class="chapter" data-level="2.2.3" data-path=""><a href="#addmargins-margin.table-and-prop.table"><i class="fa fa-check"></i><b>2.2.3</b> <code>addmargins</code>, <code>margin.table</code>, and <code>prop.table</code></a></li>
<li class="chapter" data-level="2.2.4" data-path=""><a href="#applied-example"><i class="fa fa-check"></i><b>2.2.4</b> Applied example</a></li>
<li class="chapter" data-level="2.2.5" data-path=""><a href="#mode"><i class="fa fa-check"></i><b>2.2.5</b> Mode</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#bivariate-samples"><i class="fa fa-check"></i><b>3</b> Bivariate samples</a></li>
<li class="chapter" data-level="4" data-path=""><a href="#probability-distribution-models"><i class="fa fa-check"></i><b>4</b> Probability distribution models</a>
<ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#definitions-for-continuous-random-variables"><i class="fa fa-check"></i><b>4.1</b> Definitions for continuous random variables:</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#distribution-models-for-continuous-random-variables"><i class="fa fa-check"></i><b>4.2</b> Distribution models for continuous random variables:</a></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#distribution-models-for-discrete-random-variables"><i class="fa fa-check"></i><b>4.3</b> Distribution models for discrete random variables:</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#generating-random-numbers"><i class="fa fa-check"></i><b>5</b> Generating ‘random’ numbers</a>
<ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#inversion-sampling"><i class="fa fa-check"></i><b>5.1</b> Inversion-sampling</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#case-study"><i class="fa fa-check"></i><b>6</b> Case study</a>
<ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#lets-invent-a-data-generating-machanism"><i class="fa fa-check"></i><b>6.1</b> Let’s invent a data generating machanism</a></li>
<li class="chapter" data-level="6.2" data-path=""><a href="#introduction-formula"><i class="fa fa-check"></i><b>6.2</b> Introduction <code>formula</code></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path=""><a href="#using-formula-inside-lm"><i class="fa fa-check"></i><b>6.2.1</b> Using <code>formula</code> inside <code>lm</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path=""><a href="#inspection-of-estimated-parameters"><i class="fa fa-check"></i><b>6.3</b> Inspection of estimated parameters</a></li>
<li class="chapter" data-level="6.4" data-path=""><a href="#predictive-check"><i class="fa fa-check"></i><b>6.4</b> Predictive check</a></li>
<li class="chapter" data-level="6.5" data-path=""><a href="#model-component-mu"><i class="fa fa-check"></i><b>6.5</b> Model component <code>mu</code></a></li>
<li class="chapter" data-level="6.6" data-path=""><a href="#real-data"><i class="fa fa-check"></i><b>6.6</b> Real data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path=""><a href="#predictive-check-1"><i class="fa fa-check"></i><b>6.6.1</b> Predictive check</a></li>
<li class="chapter" data-level="6.6.2" data-path=""><a href="#model-component-mu-1"><i class="fa fa-check"></i><b>6.6.2</b> Model component <code>mu</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path=""><a href="#references"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>Introduction to R: Session 04</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title"><strong>Introduction to R: Session 04</strong></h1>
<p class="author"><em>Holger Sennhenn-Reulen<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, Nordwestdeutsche Forstliche Versuchsanstalt (NW-FVA)</em></p>
<p class="date"><em>June, 20 2024 (Version 0.3)</em></p>
</div>
<!--
# About this course{-}
This course introduces basic R-programming skills needed for applied statistical modeling in R.
-->
<p>All contents are licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.</p>
<div id="working-with-real-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Working with ‘real’ data</h1>
<p>R is a powerful tool, not only for analysis, but also for managing data.</p>
<div id="reproducible-data-management" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Reproducible data management</h2>
<ul>
<li>Avoid any steps in spreadsheet-software as MS Excel that are done ‘by hand’, and that are non-reproducible.</li>
<li><em>Workflow A</em>:
<ul>
<li>Generate an R-Script <code>01_datamanagement.R</code> that loads your data and does all the steps, and returns an object <code>df</code> that is used for any further steps.</li>
<li>Run this file using <code>source(01_datamanagement.R)</code>.</li>
</ul></li>
<li><em>Workflow B</em>: Generate a markdown file that not only does the above, but also documents all your steps (A brief intro to markdown in Session 05).</li>
</ul>
</div>
<div id="preparatory-steps-prior-r" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Preparatory steps prior R</h2>
<p>Data management in <strong>R</strong> begins with loading the data into <strong>R</strong>.
But before we think about the technical way in which we read our data into <strong>R</strong>, we should first ensure that they are ‘prepared’ for this import.
If we neglect a few basic rules in this preparatory work, we actually only hold back problems (for which we then only have to find unnecessarily ‘complicated’ solutions in <strong>R</strong>).</p>
<ul>
<li>The first line of the data frame is reserved for the variable names: If we set <code>header = TRUE</code> (<strong>R</strong> functions<code>read.csv ()</code>or<code>read.table ()</code>) the first line in the data frame becomes for the variable names recycled.</li>
<li>The first column(s) should be used to define the observation unit:
Tree ID (, plot ID, …). Prefer to keep this information separate: combining several variables (in <strong>R</strong>) is easier than splitting one variable into several variables.</li>
</ul>
</div>
<div id="variable-names" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Variable names</h2>
<ul>
<li>Avoid variable names, values, or cells with spaces. If ignored – and not adequately handled during data import – each word is treated as a (value of) a separate variable. This leads to errors that are always related to the fact that the number of elements varies between the lines (matrix ‘behavior’ of the data frame).</li>
<li>If several words are to be put together, ideally use underscores, eg. <code>Count_per_ha</code> (Alternatively, you can also use dots – <code>Count.per.ha</code> –, or start every single word with a capital letter – <code>CountPerHa</code>).</li>
<li><strong>Decide on a rule and try to stick to it!</strong></li>
<li>Functions like <code>tolower</code>,<code>gsub ()</code>and<code>stringsplit</code> are useful helpers to quickly carry out repairs in <strong>R</strong>.</li>
<li>Make sure that all missing values – especially empty cells – are marked with <code>NA</code>.</li>
<li>Delete all free text comments (this only leads to extra columns or an inflation of <code>NA</code>s).</li>
</ul>
<!-- - Die erste Zeile des Datensatzes ist reserviert für die Variablennamen: Wenn wir `header=TRUE` setzen (*R* Funktionen `read.csv()` oder `read.table()`) wird die erste Zeile im Datensatz für die Variablennamen recycelt.
- Die erste(n) Spalte(n) sollte dafür genutzt werden die Beobachtungseinheit zu definieren: 
Baum-ID (, Traktecke, Trakt-ID, ...). Dabei ist zu bevorzugen die Informationen hier separat zu halten: 
- Das Zusammenfügen mehrerer Variablen ist (in *R*) einfacher als eine Variable in mehrere Variablen aufzutrennen.
- **Variablennamen:** 
- Vermeide Variablennamen, Werte oder Zellen mit Leerzeichen. Falls nicht beachtet -- und während des Datenimports nicht adäquat behandelt --, wird jedes Wort als (Wert einer) separaten Variablen betrachtet. Dies führt zu Fehlern die immer damit zusammen hängen dass die Anzahl der Werte zwischen den Zeilen verschieden sind (Matrizenverhalten des Datensatzes).
- Falls mehrere Wörter zusammengefügt werden sollen, benutzt man dafür im Idealfall Unterstriche: `Anzahl_pro_ha`. Alternativ kann man auch Punkte nutzen (`Anzahl.pro.ha`), oder jedes einzelne Wort mit einem Gro\ss buchstaben beginnen (`AnzahlProHa`).      
- Entscheide dich für eine Regel und versuche dabei zu bleiben!
- Funktionen wie `tolower`, `gsub()` und `stringsplit` sind nützliche Helfer um in *R** schnell Reparierungen durchzuführen.**
- Stelle sicher dass alle fehlenden Werte -- insbesondere leere Zellen -- durch *NA* gekennzeichnet sind.
- Lösche alle Freitextkommentare (das führt nur zu Extraspalten oder einer Inflation von *NA*s).
-->
</div>
<div id="preparatory-work-in-r" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Preparatory Work in R</h2>
<p>Before reading in a data frame, you have to tell <strong>R</strong> where the file can be found.</p>
<ul>
<li>To achieve this, it can be helpful to find out which working directory <strong>R</strong> is currently accessing:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<ul>
<li>If different from the storage location of the data frame, we have to change this working directory:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;&lt;Path of the folder in which the data file is saved&gt;&quot;</span>)</span></code></pre></div>
<p>By executing this function call, <strong>R</strong> now knows in which working directory we want to work.</p>
<p><strong>For RStudio users</strong></p>
<p>It is very helpful to save the current <code>.R</code> code file and the data frame in the same directory: At the beginning of a working session, you can then click on <em>Session</em> <span class="math inline">\(\rightarrow\)</span> <em>Set Working Directory</em> <span class="math inline">\(\rightarrow\)</span> <em>To Source File Location</em> (this also facilitates collaboration).</p>
<p>Spreadsheet software (such as MS Excel) allows data frames to be saved in many different file formats:</p>
<ul>
<li><p>The most popular non-standard formats (i.e. not <code>.xls</code> or<code>.xlsx</code>) to save a data frame are <code>.csv</code> (for <em>comma-separated value</em>) and<code>.txt</code> (tab-separated text file).</p></li>
<li><p>Depending on this choice, a line’s contents are either separated by commas or tabs (referred to as ‘separation argument’).</p></li>
<li><p><strong>Attention:</strong> Under operating systems with German language setting, commas are the default setting for the argument to represent decimal numbers. Here it is necessary to change the default values for the arguments <code>sep</code> and<code>dec</code> to <code>sep = "; "</code> and <code>dec = ", "</code> (required in <code>read.table()</code>, <code>read.csv()</code> and <code>read.csv2()</code>; see also the next sections).</p></li>
</ul>
</div>
<div id="read.table" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> <code>read.table()</code></h2>
<p>If the data was saved in the above-mentioned tab-separated text format <code>.txt</code>, the function <code>read.table()</code> is a simple way of importing data:</p>
<!--
**Für RStudio-Benutzer:**

Es ist sehr hilfreich die aktuelle `.R`-Codedatei und den Datensatz im selben Verzeichnis zu speichern: Man kann dann am Beginn einer Arbeitssitzung durch klicken auf *Session* $\rightarrow$ *Set Working Directory* $\rightarrow$ *To Source File Location* den Pfad setzen (Das macht auch insbesondere die Zusammenarbeit mit anderen Wissenschaftler:Innen einfacher).

Tabellenkalkulationsprogramme (wie *Microsoft Excel*) bieten das Abspeichern von Datensaätzen in vielen verschiedenen Dateiformaten an:

- Die beliebtesten nicht-Standard-Formate (also nicht `.xls` bzw. `.xlsx`) um einen Datensatz zu speichern sind `.csv` (*comma-separated value*) und `.txt` (Tabulatorgetrennte Textdatei).

- Abhängig von dieser Wahl werden die Zellinhalte entweder durch Kommas oder Tabs getrennt (als 'Separationsargument' bezeichnet).

- **Achtung:** Unter Betriebssystemen mit deutscher Spracheinstellung sind Kommas als Voreinstellung das Argument um Dezimalzahlen darzustellen. Hier ist es dann notwendig die voreingestellten Werte für die Argumente `sep` and `dec` auf `sep = ";"` und `dec = ","` abzuändern (wird benötigt in `read.table()`, `read.csv()` und `read.csv2()`; siehe auch die nächsten Abschnitte).

### `read.table()`.

Falls die Daten im oben erwähnten Tabulator-separierten Textformat `.txt` gespeichert wurden, kann mit der Funktion `read.table()` ein einfacher Weg des Datenimports gegangen werden:
-->
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;&lt;FileName&gt;.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<!--
- Durch die vorhergehende Festlegung des Arbeitsverzeichnisses (`setwd()**) kann der Datensatz direkt durch die Angabe des Dateinamens importiert werden.

- Durch den Wert des Arguments `header** kann festgelegt werden ob die erste Zeile des Datensatzes die Variablennamen enthält (`TRUE** ist hier der voreingestellte Wert).

- Das Separationsargument `sep** ist gesetzt auf den Wert `''**`''**, da der `read.table**-Befehl für Tabulator-separierter Textformate definiert ist.

Um ein anderes Separationsargument festzulegen, muss der Wert des Arguments `sep** verändert werden:
-->
<ul>
<li><p>By previously defining the working directory (<code>setwd ()</code>), the dataser can be imported directly by specifying the file name.</p></li>
<li><p>The value of the <code>header</code> argument can be used to determine whether the first line of the dataframe contains the variable names (<code>TRUE</code> is the default value here).</p></li>
<li><p>The separation argument <code>sep</code> is set to the value <code>""</code>, since the <code>read.table</code> command is defined for tab-separated text formats.</p></li>
</ul>
<p>To specify a different separation argument, the value of the argument <code>sep</code> must be changed:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;&lt;FileName&gt;.txt&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>)</span></code></pre></div>
</div>
<div id="read.csv-and-read.csv2" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> <code>read.csv()</code> and <code>read.csv2()</code></h2>
<p>The functions <code>read.csv()</code> and <code>read.csv2()</code> can be used to read data files in <code>.csv</code> (Comma Separated Values) format.</p>
<!--
- `.csv` Datenätze können sehr einfach in *R* importiert werden und sind darum ein zu bevorzugendes Format.
- `read.csv()` und `read.csv2()` nutzen verschiedene Separationsargumente: Für `read.csv()` das Komma, für `read.csv2()` das Semikolon (öffne deinen Datensatz in einem Texteditor um das Separationsargument leicht herauszufinden).
- `read.csv()` und `read.csv2()` sind Spezialfälle von `read.table()`: Dies bedeutet, dass die Argumente für `read.table()` wechselseitig auch für `read.csv()` und `read.csv2()` genutzt werden können.
- `read.csv()` und `read.csv2()` sind also sehr identisch zu `read.table()` und unterscheiden sich von `read.table()` in nur drei Aspekten:
- Das Separationsargument `sep`,
- das Argument `header` ist immer gleich `TRUE` gesetzt, und
- das Argument `fill` ist auch gleich `TRUE`, was bedeutet,  dass falls Zeilen ungleiche Längen haben, `read.csv()` und `read.csv2()` die kurzen Zeilen immer mit leeren Zellen auffüllen wird.
-->
<ul>
<li><code>.csv</code> dataframes can be easily imported into <strong>R</strong> and are therefore a preferred format.</li>
<li><code>read.csv()</code> and <code>read.csv2()</code> use different separation arguments: for <code>read.csv()</code> the comma, for <code>read.csv2()</code> the semicolon (open your data frame in a text editor in order to quickly find out your separation argument).</li>
<li><code>read.csv()</code> and <code>read.csv2()</code> are special cases of <code>read.table()</code>: This means that the arguments for <code>read.table()</code> can alternately also be used for <code>read.csv()</code> and <code>read.csv2()</code>.</li>
<li><code>read.csv()</code> and <code>read.csv2()</code> are very similar to <code>read.table()</code> and differ from <code>read.table()</code> in only three aspects:
<ul>
<li>The separation argument <code>sep</code>,</li>
<li>he argument <code>header</code> is always set to<code>TRUE</code>, and</li>
<li>the argument <code>fill</code> is also <code>TRUE</code>, which means that if lines have unequal lengths, <code>read.csv()</code> and <code>read.csv2()</code> will always fill the short lines with empty cells.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data.csv&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="at">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="at">stringsAsFactor =</span> F)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">names</span>(d)</span></code></pre></div>
</div>
<div id="factors" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Factors</h2>
<p><strong>Working with factors:</strong></p>
<p>In recent <strong>R</strong> versions, data imports with <code>stringsAsFactor = FALSE</code> as default, which is good:</p>
<ul>
<li>Check the structure of the data frame with the help of <code>str()</code>: Were variables imported as strings (class <code>chr</code>) and not as numeric (class <code>num</code>) as expected? If so, check the characteristics of these variables for incorrect values with <code>unique()</code> or <code>xtabs()</code>.</li>
<li>Also check with <code>unique()</code> or <code>xtabs()</code> the characteristics of the variables that were planned to be read in as <code>chr</code>: Typing errors can easily lurk here as well.</li>
<li>Use <code>df$var &lt;- as.factor(df$var)</code> to finally assign the <code>factor</code> class to variable <code>var</code>.</li>
</ul>
</div>
<div id="attach-subset-and-merge" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> <code>attach</code>, <code>subset</code> and <code>merge</code></h2>
<p>Never say never but <a href="https://www.r-bloggers.com/to-attach-or-not-attach-that-is-the-question/"><strong>never use <code>attach()</code></strong></a>.</p>
<p>… use a short name for the data frame object (e.g. <code>df</code>) to keep typing to a minimum!</p>
<p>The function <code>merge(data_set1, data_set2, by, ...)</code> can be used to link two data frames using a key variable:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;plyr&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">ddply</span>(drought, <span class="fu">c</span>(<span class="st">&quot;species&quot;</span>), summarize,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>            <span class="at">mean_bair =</span> <span class="fu">mean</span>(bair),</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>            <span class="at">sd_bair =</span> <span class="fu">sd</span>(bair),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>            <span class="at">mean_elev =</span> <span class="fu">mean</span>(elev),</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>            <span class="at">sd_elev =</span> <span class="fu">sd</span>(elev))</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">merge</span>(drought, dd, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;species&quot;</span>)))</span></code></pre></div>
<pre><code>##   species  bair  elev mean_bair   sd_bair mean_elev  sd_elev
## 1   Beech 0.697 475.0 0.8152727 0.2159037  804.3182 277.0922
## 2   Beech 0.606 480.0 0.8152727 0.2159037  804.3182 277.0922
## 3   Beech 0.718 507.5 0.8152727 0.2159037  804.3182 277.0922
## 4   Beech 0.480 580.0 0.8152727 0.2159037  804.3182 277.0922
## 5   Beech 0.822 750.0 0.8152727 0.2159037  804.3182 277.0922
## 6   Beech 0.944 780.0 0.8152727 0.2159037  804.3182 277.0922</code></pre>
<p><code>subset</code> can be used to split a dataframe according to the result of a logical comparison:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>(tmp <span class="ot">&lt;-</span> <span class="fu">range</span>(drought<span class="sc">$</span>elev <span class="sc">%/%</span> <span class="dv">250</span>))</span></code></pre></div>
<pre><code>## [1] 1 6</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>br <span class="ot">&lt;-</span> <span class="fu">seq</span>(tmp[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">250</span>, (tmp[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">250</span>, <span class="at">by =</span> <span class="dv">250</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>drought<span class="sc">$</span>elev_cut <span class="ot">&lt;-</span> <span class="fu">cut</span>(drought<span class="sc">$</span>elev, <span class="at">breaks =</span> br)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>sdf <span class="ot">&lt;-</span> <span class="fu">subset</span>(drought, elev_cut <span class="sc">==</span> <span class="st">&quot;(500,750]&quot;</span> <span class="sc">&amp;</span> species <span class="sc">==</span> <span class="st">&quot;Beech&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>sdf</span></code></pre></div>
<pre><code>##     bair  elev species  elev_cut
## 26 0.718 507.5   Beech (500,750]
## 27 0.480 580.0   Beech (500,750]
## 28 0.822 750.0   Beech (500,750]</code></pre>
<!--
# Übungen.

- Installiere und lade das Paket `lmfor`: <!-- durch (eine Internetverbidnung ist dafür notwendig):

```r
install.packages("lmfor")
library("lmfor")
```

- Mache dich mit *R* und *RStudio* vertraut indem du z.B. den Code aus dem Abschnitt ... <!-- Folie 4 in eine neue *R*-Codedatei kopierst, abspeicherst und laufen lässt (installieren des Pakets `plyr` kann dabei notwendig sein).
- Versuche selbst Vektoren, Matrizen und Listen zu erstellen: Probiere (so viel wie möglich!) aus auf welche Arten und Weisen du Indexierung durchführen kannst!
- Lade einen eigenen Datensatz nach *R*: überprüfe mit `summary`, `str` und `table` ob alle Variablen korrekt geladen wurden, keine falschen Werte enthalten und fehlende Werte korrekt als `NA` angezeigt werden.
-->
</div>
</div>
<div id="descriptive-analysis-for-univariate-samples" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Descriptive analysis for univariate samples</h1>
<div id="continuously-scaled-variable" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Continuously scaled variable</h2>
<div id="location" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Location</h3>
<ul>
<li><code>mean</code>, <code>weighted.mean</code></li>
<li><code>median</code>, <code>quantile</code> (calculates percentiles <code>probs = seq(0, 1, by = .01)</code>, and quartiles for <code>probs = c(.25, .5, .75)</code>)</li>
<li><code>summary</code> (returns: <code>min</code>, 1st quartile, <code>median</code>, <code>mean</code>, 3rd quartile, <code>max</code>)</li>
</ul>
</div>
<div id="exercises" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Exercises</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>drought<span class="sc">$</span>species <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(drought<span class="sc">$</span>species)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="do">## mean:</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">mean</span>(drought<span class="sc">$</span>bair)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="do">## weighted mean:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">nrow</span>(drought)<span class="sc">/</span><span class="fu">table</span>(drought<span class="sc">$</span>species)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species =</span> <span class="fu">factor</span>(<span class="fu">levels</span>(drought<span class="sc">$</span>species), <span class="at">levels =</span> <span class="fu">levels</span>(drought<span class="sc">$</span>species)), </span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>                  <span class="at">w =</span> <span class="fu">as.numeric</span>(tmp))</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">merge</span>(drought[, <span class="fu">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;bair&quot;</span>)], tmp, <span class="at">by =</span> <span class="st">&quot;species&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>tmp<span class="sc">$</span>w <span class="ot">&lt;-</span> tmp<span class="sc">$</span>w<span class="sc">/</span><span class="fu">sum</span>(tmp<span class="sc">$</span>w)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="at">x =</span> tmp[, <span class="fu">c</span>(<span class="st">&quot;w&quot;</span>)], <span class="at">by =</span> <span class="fu">list</span>(tmp<span class="sc">$</span>species), <span class="at">FUN =</span> sum)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="fu">weighted.mean</span>(tmp<span class="sc">$</span>bair, <span class="at">w =</span> tmp<span class="sc">$</span>w)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="fu">rm</span>(tmp)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="do">## median:</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="fu">median</span>(drought<span class="sc">$</span>bair)</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="do">## quartiles:</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="fu">quantile</span>(drought<span class="sc">$</span>bair, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>))</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="do">## summary:</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="fu">summary</span>(drought<span class="sc">$</span>bair)</span></code></pre></div>
<p><strong>Mode:</strong>
A sample of a continuously scaled variable doesn’t have a mode:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> drought, <span class="fu">aes</span>(<span class="at">x =</span> bair)) <span class="sc">+</span> </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">geom_rug</span>()</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># plot(table(drought$bair), las = 2, bty = &quot;n&quot;)</span></span></code></pre></div>
<p>… but the density of such a variable might have a maximum.
So we cannot <strong>calculate</strong> a mode, but with using techniques such as kernel density estimation – ggplot-geom <code>geom_density</code> – the location of the maximum density can be <strong>estimated</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> drought, <span class="fu">aes</span>(<span class="at">x =</span> bair)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>gp <span class="ot">&lt;-</span> <span class="fu">ggplot_build</span>(p)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>x_at_max_y <span class="ot">&lt;-</span> gp<span class="sc">$</span>data[[<span class="dv">1</span>]]<span class="sc">$</span>x[<span class="fu">which.max</span>(gp<span class="sc">$</span>data[[<span class="dv">1</span>]]<span class="sc">$</span>density)]</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_at_max_y, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
</div>
<div id="scale-variation" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Scale / variation</h3>
<p>Methods to describe the scale / variation:</p>
<ul>
<li><code>range</code> (calculates <code>min</code> and <code>max</code>)</li>
<li><code>var</code> (variance)</li>
<li><code>sd</code> (standard deviation)</li>
<li><code>mad</code> (‘median absolute deviation’, function <code>mad(x)</code> is just a more general implementation of <code>median(abs(x - median(x)))</code>)</li>
<li><code>IQR</code> (interquartile range)</li>
</ul>
<p>Argument <code>na.rm = TRUE</code> removes all missing values in advance!</p>
</div>
<div id="exercises-1" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Exercises</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> drought<span class="sc">$</span>bair</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>mad</span></code></pre></div>
<pre><code>## function (x, center = median(x), constant = 1.4826, na.rm = FALSE, 
##     low = FALSE, high = FALSE) 
## {
##     if (na.rm) 
##         x &lt;- x[!is.na(x)]
##     n &lt;- length(x)
##     constant * if ((low || high) &amp;&amp; n%%2 == 0) {
##         if (low &amp;&amp; high) 
##             stop(&quot;&#39;low&#39; and &#39;high&#39; cannot be both TRUE&quot;)
##         n2 &lt;- n%/%2 + as.integer(high)
##         sort(abs(x - center), partial = n2)[n2]
##     }
##     else median(abs(x - center))
## }
## &lt;bytecode: 0x57d260503bc8&gt;
## &lt;environment: namespace:stats&gt;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mad</span>(x, <span class="at">constant =</span> <span class="dv">1</span>),</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">median</span>(<span class="fu">abs</span>(x <span class="sc">-</span> <span class="fu">median</span>(x))),</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">sd</span>(x),</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="fu">var</span>(x),</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">IQR</span>(x))</span></code></pre></div>
<pre><code>## [1] 0.21150000 0.21150000 0.27400800 0.07508039 0.44600000</code></pre>
</div>
</div>
<div id="categorically-scaled-variables" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Categorically scaled variables</h2>
<p><code>table</code> as ‘standard function’ for absolute frequency distribution, <code>xtabs</code> as an alternative with formula syntax (and labeling with variable names if table is created from data set).</p>
<p><em>… while preparing, this section somehow got longer and longer. For a general introduction to R, at some point, when you feel like it, just move on to next section on bivariate sample.</em></p>
<div id="one-dimensional" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> One dimensional:</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">table</span>(drought<span class="sc">$</span>species)</span></code></pre></div>
<pre><code>## 
##  Beech Spruce 
##     11     23</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> drought<span class="sc">$</span>species)</span></code></pre></div>
<pre><code>## drought$species
##  Beech Spruce 
##     11     23</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> species, <span class="at">data =</span> drought)</span></code></pre></div>
<pre><code>## species
##  Beech Spruce 
##     11     23</code></pre>
<p><code>addNA</code> and <code>useNA</code> show slightly different behavior:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fu">as.character</span>(drought<span class="sc">$</span>species), <span class="cn">NA</span>))</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">table</span>(tmp)</span></code></pre></div>
<pre><code>## tmp
##  Beech Spruce 
##     11     23</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">table</span>(drought<span class="sc">$</span>species, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Beech Spruce 
##     11     23</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">table</span>(tmp, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<pre><code>## tmp
##  Beech Spruce   &lt;NA&gt; 
##     11     23      1</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">table</span>(drought<span class="sc">$</span>species, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Beech Spruce   &lt;NA&gt; 
##     11     23      0</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">table</span>(tmp, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## tmp
##  Beech Spruce   &lt;NA&gt; 
##     11     23      1</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> drought<span class="sc">$</span>species, <span class="at">addNA =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## drought$species
##  Beech Spruce 
##     11     23</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> tmp, <span class="at">addNA =</span> T)</span></code></pre></div>
<pre><code>## tmp
##  Beech Spruce   &lt;NA&gt; 
##     11     23      1</code></pre>
<p>Visualisation:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">as.data.frame</span>(<span class="fu">xtabs</span>(<span class="sc">~</span> species, <span class="at">data =</span> drought))) <span class="sc">+</span> </span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> species, <span class="at">y =</span> Freq)) <span class="sc">+</span> </span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="two-dimensional" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Two dimensional</h3>
<p>… this illustrational example shows <em>bad scientific practice</em> since we cut continuous variables into binary categories, and by this bin a lot of valuable information!</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species =</span> drought<span class="sc">$</span>species)</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>tmp<span class="sc">$</span>elevation <span class="ot">&lt;-</span> <span class="fu">cut</span>(drought<span class="sc">$</span>elev, <span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="fu">range</span>(drought<span class="sc">$</span>elev), <span class="dv">1000</span>)), <span class="at">include.lowest =</span> T, <span class="at">dig.lab =</span> <span class="dv">4</span>)</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>tmp<span class="sc">$</span>bair <span class="ot">&lt;-</span> <span class="fu">cut</span>(drought<span class="sc">$</span>bair, <span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">c</span>(<span class="fu">range</span>(drought<span class="sc">$</span>bair), <span class="dv">1</span>)), <span class="at">include.lowest =</span> T)</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="fu">table</span>(tmp<span class="sc">$</span>bair, tmp<span class="sc">$</span>elevation) <span class="do">##  ... (a bit) lost.</span></span></code></pre></div>
<pre><code>##            
##             [335,1000] (1000,1540]
##   [0.257,1]         19           9
##   (1,1.28]           0           6</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> bair <span class="sc">+</span> elevation, <span class="at">data =</span> tmp) <span class="do">## ... with variable name labels!</span></span></code></pre></div>
<pre><code>##            elevation
## bair        [335,1000] (1000,1540]
##   [0.257,1]         19           9
##   (1,1.28]           0           6</code></pre>
<p>Default <code>plot</code> (see add-on package <code>ggmosaic</code> for a ggplot alternative):</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> bair <span class="sc">+</span> elevation, <span class="at">data =</span> tmp) <span class="do">## Labels!</span></span></code></pre></div>
<pre><code>##            elevation
## bair        [335,1000] (1000,1540]
##   [0.257,1]         19           9
##   (1,1.28]           0           6</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">xtabs</span>(<span class="sc">~</span> bair <span class="sc">+</span> elevation, <span class="at">data =</span> tmp), <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co"># install.packages(&quot;ggmosaic&quot;)</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggmosaic&quot;</span>)</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> tmp) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>  <span class="fu">geom_mosaic</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">product</span>(elevation, bair), </span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>                  <span class="at">fill =</span> elevation))</span></code></pre></div>
<pre><code>## Warning: The `scale_name` argument of `continuous_scale()` is deprecated as of ggplot2
## 3.5.0.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: The `trans` argument of `continuous_scale()` is deprecated as of ggplot2 3.5.0.
## ℹ Please use the `transform` argument instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: `unite_()` was deprecated in tidyr 1.2.0.
## ℹ Please use `unite()` instead.
## ℹ The deprecated feature was likely used in the ggmosaic package.
##   Please report the issue at &lt;https://github.com/haleyjeppson/ggmosaic&gt;.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
</div>
<div id="addmargins-margin.table-and-prop.table" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> <code>addmargins</code>, <code>margin.table</code>, and <code>prop.table</code></h3>
<p>One dimensional:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>## 
## [0.257,1]  (1,1.28]       Sum 
##        28         6        34</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>## [1] 34</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>## 
## [0.257,1]  (1,1.28] 
## 0.8235294 0.1764706</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>bair)))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Two dimensional:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>##              
##               [0.257,1] (1,1.28] Sum
##   [335,1000]         19        0  19
##   (1000,1540]         9        6  15
##   Sum                28        6  34</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>## [1] 34</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##  [335,1000] (1000,1540] 
##          19          15</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## 
## [0.257,1]  (1,1.28] 
##        28         6</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair))</span></code></pre></div>
<pre><code>##              
##               [0.257,1]  (1,1.28]
##   [335,1000]  0.5588235 0.0000000
##   (1000,1540] 0.2647059 0.1764706</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##              
##               [0.257,1] (1,1.28]
##   [335,1000]        1.0      0.0
##   (1000,1540]       0.6      0.4</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##              
##               [0.257,1]  (1,1.28]
##   [335,1000]  0.6785714 0.0000000
##   (1000,1540] 0.3214286 1.0000000</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="fu">margin.table</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair)))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair)))</span></code></pre></div>
<pre><code>##              
##               [0.257,1]  (1,1.28]       Sum
##   [335,1000]  0.5588235 0.0000000 0.5588235
##   (1000,1540] 0.2647059 0.1764706 0.4411765
##   Sum         0.8235294 0.1764706 1.0000000</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##              
##               [0.257,1] (1,1.28] Sum
##   [335,1000]        1.0      0.0 1.0
##   (1000,1540]       0.6      0.4 1.0
##   Sum               1.6      0.4 2.0</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>##              
##               [0.257,1]  (1,1.28]       Sum
##   [335,1000]  0.6785714 0.0000000 0.6785714
##   (1000,1540] 0.3214286 1.0000000 1.3214286
##   Sum         1.0000000 1.0000000 2.0000000</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">1</span>), <span class="at">margin =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##              
##               [0.257,1] (1,1.28] Sum
##   [335,1000]        1.0      0.0 1.0
##   (1000,1540]       0.6      0.4 1.0</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(tmp<span class="sc">$</span>elevation, tmp<span class="sc">$</span>bair), <span class="at">margin =</span> <span class="dv">2</span>), <span class="at">margin =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##              
##               [0.257,1]  (1,1.28]
##   [335,1000]  0.6785714 0.0000000
##   (1000,1540] 0.3214286 1.0000000
##   Sum         1.0000000 1.0000000</code></pre>
</div>
<div id="applied-example" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Applied example</h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="do">## Session 03:</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a>overlap_seq <span class="ot">&lt;-</span> <span class="cf">function</span>(x, delta) {</span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">%/%</span> delta</span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a>  tmp2 <span class="ot">&lt;-</span> x <span class="sc">%%</span> delta</span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a>  <span class="cf">if</span> (tmp2[<span class="fu">which.max</span>(x)] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb86-6"><a href="#cb86-6" tabindex="-1"></a>    result <span class="ot">&lt;-</span> delta <span class="sc">*</span> (<span class="fu">min</span>(tmp, <span class="at">na.rm =</span> T)<span class="sc">:</span><span class="fu">max</span>(tmp, <span class="at">na.rm =</span> T))</span>
<span id="cb86-7"><a href="#cb86-7" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb86-8"><a href="#cb86-8" tabindex="-1"></a>    result <span class="ot">&lt;-</span> delta <span class="sc">*</span> (<span class="fu">min</span>(tmp, <span class="at">na.rm =</span> T)<span class="sc">:</span>(<span class="fu">max</span>(tmp, <span class="at">na.rm =</span> T) <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb86-9"><a href="#cb86-9" tabindex="-1"></a>  }</span>
<span id="cb86-10"><a href="#cb86-10" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb86-11"><a href="#cb86-11" tabindex="-1"></a>}</span>
<span id="cb86-12"><a href="#cb86-12" tabindex="-1"></a>tmp<span class="sc">$</span>elevCut <span class="ot">&lt;-</span> <span class="fu">cut</span>(drought<span class="sc">$</span>elev, <span class="at">breaks =</span> <span class="fu">overlap_seq</span>(<span class="at">x =</span> drought<span class="sc">$</span>elev, <span class="at">delta =</span> <span class="dv">250</span>), <span class="at">dig.lab =</span> <span class="dv">4</span>)</span>
<span id="cb86-13"><a href="#cb86-13" tabindex="-1"></a>tmp<span class="sc">$</span>bairCut <span class="ot">&lt;-</span> <span class="fu">cut</span>(drought<span class="sc">$</span>bair, <span class="at">breaks =</span> <span class="fu">overlap_seq</span>(<span class="at">x =</span> drought<span class="sc">$</span>bair, <span class="at">delta =</span> .<span class="dv">25</span>))</span>
<span id="cb86-14"><a href="#cb86-14" tabindex="-1"></a>(xtab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> elevCut <span class="sc">+</span> bairCut <span class="sc">+</span> species, <span class="at">data =</span> tmp))</span></code></pre></div>
<pre><code>## , , species = Beech
## 
##              bairCut
## elevCut       (0.25,0.5] (0.5,0.75] (0.75,1] (1,1.25] (1.25,1.5]
##   (250,500]            0          2        0        0          0
##   (500,750]            1          1        1        0          0
##   (750,1000]           0          0        2        0          0
##   (1000,1250]          0          1        1        2          0
##   (1250,1500]          0          0        0        0          0
##   (1500,1750]          0          0        0        0          0
## 
## , , species = Spruce
## 
##              bairCut
## elevCut       (0.25,0.5] (0.5,0.75] (0.75,1] (1,1.25] (1.25,1.5]
##   (250,500]            0          3        0        0          0
##   (500,750]            4          1        1        0          0
##   (750,1000]           1          1        1        0          0
##   (1000,1250]          1          2        2        1          1
##   (1250,1500]          0          0        1        2          0
##   (1500,1750]          0          0        1        0          0</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">addmargins</span>(<span class="fu">prop.table</span>(xtab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))), <span class="dv">2</span>)[, , <span class="st">&quot;Beech&quot;</span>]</span></code></pre></div>
<pre><code>##              bairCut
## elevCut       (0.25,0.5] (0.5,0.75] (0.75,1] (1,1.25] (1.25,1.5]    Sum
##   (250,500]         0.00     100.00     0.00     0.00       0.00 100.00
##   (500,750]        33.33      33.33    33.33     0.00       0.00 100.00
##   (750,1000]        0.00       0.00   100.00     0.00       0.00 100.00
##   (1000,1250]       0.00      25.00    25.00    50.00       0.00 100.00
##   (1250,1500]                                                          
##   (1500,1750]                                                          
##   Sum</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">addmargins</span>(<span class="fu">prop.table</span>(xtab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))), <span class="dv">2</span>)[, , <span class="st">&quot;Spruce&quot;</span>]</span></code></pre></div>
<pre><code>##              bairCut
## elevCut       (0.25,0.5] (0.5,0.75] (0.75,1] (1,1.25] (1.25,1.5]    Sum
##   (250,500]         0.00     100.00     0.00     0.00       0.00 100.00
##   (500,750]        66.67      16.67    16.67     0.00       0.00 100.00
##   (750,1000]       33.33      33.33    33.33     0.00       0.00 100.00
##   (1000,1250]      14.29      28.57    28.57    14.29      14.29 100.00
##   (1250,1500]       0.00       0.00    33.33    66.67       0.00 100.00
##   (1500,1750]       0.00       0.00   100.00     0.00       0.00 100.00
##   Sum             114.29     178.57   211.90    80.95      14.29 600.00</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>) <span class="sc">+</span> .<span class="dv">1</span>)</span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">xtabs</span>(<span class="sc">~</span> species <span class="sc">+</span> elevCut <span class="sc">+</span> bairCut, <span class="at">data =</span> tmp), <span class="at">las =</span> <span class="dv">2</span>, <span class="at">off =</span> <span class="dv">5</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a>     <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">divergingx_hcl</span>(<span class="at">n =</span> <span class="fu">length</span>(<span class="fu">levels</span>(tmp<span class="sc">$</span>bairCut)), <span class="at">rev =</span> T))</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="mode" class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Mode</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a>(xtab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> species <span class="sc">+</span> elevCut <span class="sc">+</span> bairCut, <span class="at">data =</span> tmp))</span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a><span class="fu">sort</span>(xtab, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>]</span>
<span id="cb93-3"><a href="#cb93-3" tabindex="-1"></a><span class="fu">which</span>(xtab <span class="sc">==</span> <span class="fu">max</span>(xtab), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb93-4"><a href="#cb93-4" tabindex="-1"></a>xtab[<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>]</span></code></pre></div>
</div>
</div>
</div>
<div id="bivariate-samples" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Bivariate samples</h1>
<p><strong>A bivariate sample is a set of observation units, for which each has two characteristics that have been measured.</strong></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">5</span>, <span class="at">data =</span> <span class="fu">runif</span>(<span class="dv">25</span>))</span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a>A[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##           [,1]      [,2]
## [1,] 0.2875775 0.0455565
## [2,] 0.7883051 0.5281055
## [3,] 0.4089769 0.8924190
## [4,] 0.8830174 0.5514350
## [5,] 0.9404673 0.4566147</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="fu">pmax</span>(A[, <span class="dv">1</span>], A[, <span class="dv">2</span>]) <span class="do">## parallel maxima</span></span></code></pre></div>
<pre><code>## [1] 0.2875775 0.7883051 0.8924190 0.8830174 0.9404673</code></pre>
<ul>
<li><code>cor</code> for correlation coefficient,</li>
<li><code>cov</code> for (variance) covariance (matrix).</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> drought<span class="sc">$</span>bair</span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> drought<span class="sc">$</span>elev<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.6174439</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="fu">cov</span>(<span class="fu">cbind</span>(x, y))</span></code></pre></div>
<pre><code>##            x          y
## x 0.07508039 0.05579038
## y 0.05579038 0.10874194</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">cov</span>(x, y), <span class="fu">var</span>(x), <span class="fu">var</span>(y))</span></code></pre></div>
<pre><code>## [1] 0.05579038 0.07508039 0.10874194</code></pre>
</div>
<div id="probability-distribution-models" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Probability distribution models</h1>
<div id="definitions-for-continuous-random-variables" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Definitions for continuous random variables:</h2>
<ul>
<li>Random variable <span class="math inline">\(X\in\mathbf{R}\)</span> follows distribution <span class="math inline">\(F\)</span> with density <span class="math inline">\(f(x)\geq0\,\forall x\in\mathbf{R}\)</span></li>
<li>Cumulative density function <span class="math inline">\(F(x)=\int\limits_{-\infty}^{x}{f(z)}\text{d}z\)</span>, with <span class="math inline">\(F(-\infty)=0\)</span> and <span class="math inline">\(F(\infty)=1\)</span>.</li>
<li>Quantile function <span class="math inline">\(Q(x)=F^{-1}(x)\)</span></li>
</ul>
<p>Implementation in R: <code>code</code> + distribution abbreviation</p>
<table>
<thead>
<tr class="header">
<th align="left">Code</th>
<th align="left">meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>d</code></td>
<td align="left">density</td>
</tr>
<tr class="even">
<td align="left"><code>p</code></td>
<td align="left">cdf (probability)</td>
</tr>
<tr class="odd">
<td align="left"><code>q</code></td>
<td align="left">quantile</td>
</tr>
<tr class="even">
<td align="left"><code>r</code></td>
<td align="left">random number generation</td>
</tr>
</tbody>
</table>
</div>
<div id="distribution-models-for-continuous-random-variables" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Distribution models for continuous random variables:</h2>
<table>
<thead>
<tr class="header">
<th align="left">Distribution</th>
<th align="left">Abbreviation</th>
<th align="left">Parameter</th>
<th align="center">Wiki</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Continuous uniform</td>
<td align="left"><code>unif</code></td>
<td align="left"><code>min</code>, <code>max</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Continuous_uniform_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Normal (aka. Gaussian)</td>
<td align="left"><code>norm</code></td>
<td align="left"><code>mean</code>, <code>sd</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Normal_distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">Lognormal</td>
<td align="left"><code>lnorm</code></td>
<td align="left"><code>meanlog</code>, <code>sdlog</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Log-normal_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Exponential</td>
<td align="left"><code>exp</code></td>
<td align="left"><code>rate</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Exponential_distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">Beta</td>
<td align="left"><code>beta</code></td>
<td align="left"><code>shape1</code>, <code>shape2</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Beta_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Chi-squared</td>
<td align="left"><code>chisq</code></td>
<td align="left"><code>df</code>, <code>ncp</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Chi-squared_distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">F</td>
<td align="left"><code>f</code></td>
<td align="left"><code>df1</code>, <code>df2</code>, <code>ncp</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/F-distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Student-t</td>
<td align="left"><code>t</code></td>
<td align="left"><code>df</code>, <code>ncp</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Student%27s_t-distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">Gamma</td>
<td align="left"><code>gamma</code></td>
<td align="left"><code>shape</code>, <code>rate</code>, <code>scale</code> = 1/<code>rate</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Gamma_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Weibull</td>
<td align="left"><code>weibull</code></td>
<td align="left"><code>shape</code>, <code>scale</code></td>
<td align="center"><a href="https://en.wikipedia.org/wiki/Weibull_distribution">Link</a></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;U[0, 1]&quot;</span>, </span>
<span id="cb104-4"><a href="#cb104-4" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">runif</span>(<span class="at">n =</span> N, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)),</span>
<span id="cb104-5"><a href="#cb104-5" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Beta(1/3, 1/3)&quot;</span>, </span>
<span id="cb104-6"><a href="#cb104-6" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="at">n =</span> N, <span class="at">shape1 =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape2 =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)),</span>
<span id="cb104-7"><a href="#cb104-7" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;N(0, 1)&quot;</span>, </span>
<span id="cb104-8"><a href="#cb104-8" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)),</span>
<span id="cb104-9"><a href="#cb104-9" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;t(3)&quot;</span>, </span>
<span id="cb104-10"><a href="#cb104-10" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rt</span>(<span class="at">n =</span> N, <span class="at">df =</span> <span class="dv">3</span>, <span class="at">ncp =</span> <span class="dv">0</span>)),</span>
<span id="cb104-11"><a href="#cb104-11" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;logN(0, 1)&quot;</span>, </span>
<span id="cb104-12"><a href="#cb104-12" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rlnorm</span>(<span class="at">n =</span> N, <span class="at">meanlog =</span> <span class="dv">0</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)),</span>
<span id="cb104-13"><a href="#cb104-13" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Exp(1)&quot;</span>, </span>
<span id="cb104-14"><a href="#cb104-14" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rexp</span>(<span class="at">n =</span> N, <span class="at">rate =</span> <span class="dv">1</span>)),</span>
<span id="cb104-15"><a href="#cb104-15" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Chi2(3)&quot;</span>, </span>
<span id="cb104-16"><a href="#cb104-16" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rchisq</span>(<span class="at">n =</span> N, <span class="at">df =</span> <span class="dv">3</span>, <span class="at">ncp =</span> <span class="dv">0</span>)),</span>
<span id="cb104-17"><a href="#cb104-17" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;F(10, 10)&quot;</span>, </span>
<span id="cb104-18"><a href="#cb104-18" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rf</span>(<span class="at">n =</span> N, <span class="at">df1 =</span> <span class="dv">10</span>, <span class="at">df2 =</span> <span class="dv">10</span>, <span class="at">ncp =</span> <span class="dv">0</span>)),</span>
<span id="cb104-19"><a href="#cb104-19" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Gamma(1, 2)&quot;</span>, </span>
<span id="cb104-20"><a href="#cb104-20" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rgamma</span>(<span class="at">n =</span> N, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">rate =</span> <span class="dv">2</span>)),</span>
<span id="cb104-21"><a href="#cb104-21" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Weibull(1, 2)&quot;</span>, </span>
<span id="cb104-22"><a href="#cb104-22" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">rweibull</span>(<span class="at">n =</span> N, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="dv">2</span>)))</span>
<span id="cb104-23"><a href="#cb104-23" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> A, <span class="fu">aes</span>(<span class="at">x =</span> distribution, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-24"><a href="#cb104-24" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outliers =</span> F) <span class="sc">+</span> </span>
<span id="cb104-25"><a href="#cb104-25" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="distribution-models-for-discrete-random-variables" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Distribution models for discrete random variables:</h2>
<table>
<thead>
<tr class="header">
<th align="left">Distribution</th>
<th align="left">Abbreviation</th>
<th align="left">Parameters</th>
<th align="left">Wiki</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Binomial</td>
<td align="left"><code>binom</code></td>
<td align="left"><code>size</code>, <code>prob</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Binomial_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Hypergeometric</td>
<td align="left"><code>hyper</code></td>
<td align="left"><code>m</code>, <code>n</code>,<code>k</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Hypergeometric_distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">Negative binomial</td>
<td align="left"><code>nbinom</code></td>
<td align="left"><code>size</code>, <code>prob</code>,<code>mu</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Poisson</td>
<td align="left"><code>pois</code></td>
<td align="left"><code>lambda</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Poisson_binomial_distribution">Link</a></td>
</tr>
<tr class="odd">
<td align="left">Geometric</td>
<td align="left"><code>geom</code></td>
<td align="left"><code>prob</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Geometric_distribution">Link</a></td>
</tr>
<tr class="even">
<td align="left">Multinomial</td>
<td align="left"><code>multinom</code></td>
<td align="left"><code>size</code>, <code>prob</code></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Multinomial_distribution">Link</a></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Binomial(10, .5)&quot;</span>, <span class="at">value =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> N, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> .<span class="dv">5</span>)),</span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Hyper(7, 3, 8)&quot;</span>, <span class="at">value =</span> <span class="fu">rhyper</span>(<span class="at">nn =</span> N, <span class="at">m =</span> <span class="dv">7</span>, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">k =</span> <span class="dv">8</span>)),</span>
<span id="cb105-5"><a href="#cb105-5" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;NegBin(10, .5)&quot;</span>, <span class="at">value =</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> N, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> .<span class="dv">5</span>)),</span>
<span id="cb105-6"><a href="#cb105-6" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Poisson(3)&quot;</span>, <span class="at">value =</span> <span class="fu">rpois</span>(<span class="at">n =</span> N, <span class="at">lambda =</span> <span class="dv">3</span>)),</span>
<span id="cb105-7"><a href="#cb105-7" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;distribution&quot;</span> <span class="ot">=</span> <span class="st">&quot;Geom(.5)&quot;</span>, <span class="at">value =</span> <span class="fu">rgeom</span>(<span class="at">n =</span> N, <span class="at">prob =</span> .<span class="dv">5</span>)))</span>
<span id="cb105-8"><a href="#cb105-8" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> A, <span class="fu">aes</span>(<span class="at">x =</span> distribution, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb105-9"><a href="#cb105-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outliers =</span> F) <span class="sc">+</span> </span>
<span id="cb105-10"><a href="#cb105-10" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Multinomial:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(<span class="at">n =</span> N, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">1</span>, .<span class="dv">8</span>))</span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="st">&quot;x&quot;</span> <span class="ot">=</span> <span class="st">&quot;1&quot;</span>, </span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> A[<span class="dv">1</span>, ]),</span>
<span id="cb106-4"><a href="#cb106-4" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;x&quot;</span> <span class="ot">=</span> <span class="st">&quot;2&quot;</span>, </span>
<span id="cb106-5"><a href="#cb106-5" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> A[<span class="dv">2</span>, ]),</span>
<span id="cb106-6"><a href="#cb106-6" tabindex="-1"></a>           <span class="fu">data.frame</span>(<span class="st">&quot;x&quot;</span> <span class="ot">=</span> <span class="st">&quot;3&quot;</span>, </span>
<span id="cb106-7"><a href="#cb106-7" tabindex="-1"></a>                      <span class="st">&quot;value&quot;</span> <span class="ot">=</span> A[<span class="dv">3</span>, ]))</span>
<span id="cb106-8"><a href="#cb106-8" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> A, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb106-9"><a href="#cb106-9" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outliers =</span> F) <span class="sc">+</span> </span>
<span id="cb106-10"><a href="#cb106-10" tabindex="-1"></a>  <span class="fu">geom_jitter</span>()</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>
<div id="generating-random-numbers" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Generating ‘random’ numbers</h1>
<!--

% - number of starting values is finite due to computational accuracy
% - hence $x_n = x_{n+p} $ for large $n$
% 
% - large period $p$ needed
% - uniform distribution within period needed
% - independent subsequent numbers needed
% 
% - define starting values $ x_1, \dots x_n$
% - generate random number $ x_{n+1} = a x_n \mod m$
% - with
% 
% - $x_n,a \in \{0,\dots,2^{31}-1\} $
% - prime $ m = 2^{31}-1$
% - greatest common divisor $gcd(a,m) = 1$, $gcd(x_0,m) = 1$
% - $\tilde{x}_n = \frac{x_n}{m} \in [0,1] $
-->
<ul>
<li>Random numbers are generated in R by an algorithm, they are not real random – whatever this is …</li>
<li>Before a new random number is generated, this algorithm is in a certain state.</li>
<li>The (next) random number depends on this state, drawing this new number alters the state.</li>
<li><code>RNGkind()</code> lists three character strings for three tasks:
<ul>
<li><code>kind</code> is for draws from the continuous uniform distribution.</li>
<li><code>normal.kind</code> is for draws from the normal distribution (I don’t know why there’s this specific kind for the normal, I suppose as the normal distribution is historically so important, there have been algorithms specifically designed for drawing from this distribution …).</li>
<li><code>sample.kind</code> for drawing from the diccrete uniform distribution.</li>
</ul></li>
<li>Why we won’t have a look on the other algorithms, seeing the idea behind <code>Inversion</code> sampling is really helpful in order to see why being able to generate draws from continuous uniform distribution is already sufficient in order to sample from any other distribution.</li>
<li>Reproducibility is often an important property!
<ul>
<li>The state of the random number generating algorithm is initialized by a seed.</li>
<li>Seeds are generated by system time and session ID (<code>?RNG</code>)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a><span class="fu">Sys.getpid</span>()</span></code></pre></div>
<pre><code>## [1] 7082</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>(t1 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>())</span></code></pre></div>
<pre><code>## [1] &quot;2024-06-19 14:27:31 CEST&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a>(t2 <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>())</span></code></pre></div>
<pre><code>## [1] &quot;2024-06-19 14:27:31 CEST&quot;</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a>t2 <span class="sc">-</span> t1</span></code></pre></div>
<pre><code>## Time difference of 0.0006723404 secs</code></pre>
<ul>
<li>We can overwrite thus seed generating by using <code>set.seed()</code>:</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.44941139 0.76616653 0.02609772 0.19517143 0.88123456</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.2875775 0.7883051 0.4089769 0.8830174 0.9404673</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.0455565 0.5281055 0.8924190 0.5514350 0.4566147</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.2875775 0.7883051 0.4089769 0.8830174 0.9404673</code></pre>
<ul>
<li>Generate random numbers using <code>r</code> + distribution abbreviation (uses inversion - sampling)</li>
<li>Random numbers from sets with <code>sample (c (), size, replace = TRUE)</code>.</li>
</ul>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="fu">RNGkind</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Mersenne-Twister&quot; &quot;Inversion&quot;        &quot;Rejection&quot;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1604</span>)</span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 1 1 1 0 1</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 0 1 0 1 0</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1604</span>)</span>
<span id="cb129-2"><a href="#cb129-2" tabindex="-1"></a><span class="fu">rbinom</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>## [1] 1 1 1 0 1</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 5 4 1 6 2</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 10  5  4  5  4</code></pre>
<div id="inversion-sampling" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Inversion-sampling</h2>
<p><strong>Inversion sampling is a rather simple application of a mathemcatical thing – the inverse of the cumulative distribution function – that one easily brands as ‘interesting only in mathematical theory’, but which has an incredibly applied value!</strong></p>
<p>Let random variable <span class="math inline">\(X\)</span> have cumulative distribution function <span class="math inline">\(F\)</span>.</p>
<p>Let’s assume for the moment we can draw random numbers from this distribution, eg. from the standard normal:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span></code></pre></div>
<p>If we plug these into the cumulative distribution function</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(x)</span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">u =</span> u)) <span class="sc">+</span> </span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> u))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>we obviously get random draws from the continuous uniform distribution <span class="math inline">\(U[0,1]\)</span>, ie. <span class="math inline">\(F(X)\sim\text{U}(0,1)\)</span>.</p>
<p>Now all we need to do is to solve this equation:</p>
<p><span class="math display">\[
F(X)=Z, Z\sim U[0,1]
\]</span>
with respect to <span class="math inline">\(X\)</span>:
<span class="math display">\[
X=F^{-1}(Z), Z\sim U[0,1]
\]</span></p>
<p>For application this means that as long as we can draw from a continuous uniform distribution, and as long as we can write down <span class="math inline">\(F^{-1}\)</span>, we can generate random draws for <span class="math inline">\(X\)</span>.</p>
<p>Inversion sampling:</p>
<ul>
<li>generate numbers <span class="math inline">\(u_1,\dots,u_n\)</span> from the continuous uniform distribution <span class="math inline">\(U[0,1]\)</span></li>
<li>transform <span class="math inline">\(x_k=F^{-1}(u_k)\)</span></li>
</ul>
<p>In R, <span class="math inline">\(F^{-1}(u_k)\)</span> is given as <code>q...</code>.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">5</span>)</span>
<span id="cb138-2"><a href="#cb138-2" tabindex="-1"></a><span class="fu">qnorm</span>(<span class="at">p =</span> u)</span></code></pre></div>
<pre><code>## [1] -1.9728444 -1.2169369 -2.2157531 -0.8150545  2.4262442</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="fu">qweibull</span>(<span class="at">p =</span> u, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.02455568 0.11857422 0.01344418 0.23258871 4.87592939</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a><span class="fu">qbinom</span>(<span class="at">p =</span> u, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">prob =</span> .<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 2 3 2 4 9</code></pre>
</div>
</div>
<div id="case-study" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Case study</h1>
<div id="lets-invent-a-data-generating-machanism" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Let’s invent a data generating machanism</h2>
<p>Because of a drought in one year, trees grow less in this year in comparison to the preceding year.
However, by differences in the availability to growth-ressources by different elevations at the same mountain range, this reduction is reversed above a certain elevation threshold.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a>(elev <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">400</span>, <span class="dv">1800</span>, <span class="at">by =</span> <span class="dv">50</span>) <span class="sc">/</span> <span class="dv">1000</span>)</span></code></pre></div>
<pre><code>##  [1] 0.40 0.45 0.50 0.55 0.60 0.65 0.70 0.75 0.80 0.85 0.90 0.95 1.00 1.05 1.10
## [16] 1.15 1.20 1.25 1.30 1.35 1.40 1.45 1.50 1.55 1.60 1.65 1.70 1.75 1.80</code></pre>
<p>For species A and B:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" tabindex="-1"></a>muA <span class="ot">&lt;-</span> .<span class="dv">7</span> <span class="sc">+</span> .<span class="dv">25</span> <span class="sc">*</span> elev</span>
<span id="cb146-2"><a href="#cb146-2" tabindex="-1"></a>muB <span class="ot">&lt;-</span> .<span class="dv">8</span> <span class="sc">+</span> .<span class="dv">15</span> <span class="sc">*</span> elev</span>
<span id="cb146-3"><a href="#cb146-3" tabindex="-1"></a>paint <span class="ot">&lt;-</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb146-4"><a href="#cb146-4" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="fu">length</span>(elev)), </span>
<span id="cb146-5"><a href="#cb146-5" tabindex="-1"></a>                         <span class="at">mu =</span> <span class="fu">c</span>(muA, muB), </span>
<span id="cb146-6"><a href="#cb146-6" tabindex="-1"></a>                         <span class="at">elevation =</span> <span class="fu">c</span>(elev, elev))) <span class="sc">+</span> </span>
<span id="cb146-7"><a href="#cb146-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> elevation, <span class="at">y =</span> mu, <span class="at">color =</span> k, <span class="at">group =</span> k))</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>Random variation in site-specific availability to growth-ressources:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb147-2"><a href="#cb147-2" tabindex="-1"></a>epsA <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(muA), <span class="at">sd =</span> .<span class="dv">05</span>)</span>
<span id="cb147-3"><a href="#cb147-3" tabindex="-1"></a>epsB <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(muB), <span class="at">sd =</span> .<span class="dv">05</span>)</span>
<span id="cb147-4"><a href="#cb147-4" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="fu">length</span>(elev)), </span>
<span id="cb147-5"><a href="#cb147-5" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(muA <span class="sc">+</span> epsA, muB <span class="sc">+</span> epsB), </span>
<span id="cb147-6"><a href="#cb147-6" tabindex="-1"></a>                         <span class="at">elevation =</span> <span class="fu">c</span>(elev, elev))) <span class="sc">+</span> </span>
<span id="cb147-7"><a href="#cb147-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> elevation, <span class="at">y =</span> y, <span class="at">color =</span> k, <span class="at">group =</span> k))</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Compose outcome measurements <code>y</code>:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" tabindex="-1"></a>yA <span class="ot">&lt;-</span> muA <span class="sc">+</span> epsA</span>
<span id="cb148-2"><a href="#cb148-2" tabindex="-1"></a>yB <span class="ot">&lt;-</span> muB <span class="sc">+</span> epsB</span></code></pre></div>
</div>
<div id="introduction-formula" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Introduction <code>formula</code></h2>
<p><code>formula</code> notation for the data generating mechanism:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a>frmlaA <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(yA <span class="sc">~</span> elev)</span>
<span id="cb149-2"><a href="#cb149-2" tabindex="-1"></a><span class="fu">str</span>(frmlaA)</span></code></pre></div>
<pre><code>## Class &#39;formula&#39;  language yA ~ elev
##   ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt;</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a><span class="fu">summary</span>(frmlaA)</span></code></pre></div>
<pre><code>##  Length   Class    Mode 
##       3 formula    call</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" tabindex="-1"></a>frmlaA[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## `~`()</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" tabindex="-1"></a>frmlaA[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## yA()</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" tabindex="-1"></a>frmlaA[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## elev()</code></pre>
<ul>
<li><code>yA</code> and <code>yB</code> are measured outcomes, written on the left hand side of the formula</li>
<li>The left hand side is separated from the right hand side by <code>~</code></li>
<li>The right hand side expresses the explanatory variables that are either experimentally controlled, or – similar to the outcome – observed / measured. In our formula examples, <code>elev</code> is the only explanatory variable.</li>
<li>The parameters used for generating the outcome, <code>.7</code>, <code>.25</code> and <code>.05</code> for A, and <code>.8</code>, <code>.15</code> and <code>.05</code> for B, are not stated in the formula. Why? … because in real world applications, we don’t artificially invent, but rather want to estimate their plausible values based on our data.</li>
<li>Let’s assume it comes to our mind that a normal distribution is a statistical model that is quite useful to express the effects of variation in site-specific availability to growth-ressources on the outcome. Then:</li>
</ul>
<p>We can use a formula directly for <code>plot</code>:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" tabindex="-1"></a>frmlaB <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(yB <span class="sc">~</span> elev)</span>
<span id="cb159-2"><a href="#cb159-2" tabindex="-1"></a><span class="fu">plot</span>(frmlaA, <span class="at">pch =</span> <span class="st">&quot;A&quot;</span>, <span class="at">col =</span> paint[<span class="dv">1</span>])</span>
<span id="cb159-3"><a href="#cb159-3" tabindex="-1"></a><span class="fu">points</span>(frmlaB, <span class="at">pch =</span> <span class="st">&quot;B&quot;</span>, <span class="at">col =</span> paint[<span class="dv">2</span>])</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<div id="using-formula-inside-lm" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Using <code>formula</code> inside <code>lm</code></h3>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" tabindex="-1"></a>mA <span class="ot">&lt;-</span> <span class="fu">lm</span>(frmlaA)</span>
<span id="cb160-2"><a href="#cb160-2" tabindex="-1"></a>mB <span class="ot">&lt;-</span> <span class="fu">lm</span>(frmlaB)</span>
<span id="cb160-3"><a href="#cb160-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb160-4"><a href="#cb160-4" tabindex="-1"></a><span class="fu">plot</span>(frmlaA, <span class="at">pch =</span> <span class="st">&quot;A&quot;</span>, <span class="at">col =</span> paint[<span class="dv">1</span>])</span>
<span id="cb160-5"><a href="#cb160-5" tabindex="-1"></a><span class="fu">abline</span>(mA, <span class="at">col =</span> paint[<span class="dv">1</span>])</span>
<span id="cb160-6"><a href="#cb160-6" tabindex="-1"></a><span class="fu">points</span>(frmlaB, <span class="at">pch =</span> <span class="st">&quot;B&quot;</span>, <span class="at">col =</span> paint[<span class="dv">2</span>])</span>
<span id="cb160-7"><a href="#cb160-7" tabindex="-1"></a><span class="fu">abline</span>(mB, <span class="at">col =</span> paint[<span class="dv">2</span>])</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>The data-generating mechanisms varied for varying species A, and B.
Can we unify this into one description of a data-generating mechanism?</p>
<p><span class="math display">\[
yA=0.7+0.25\cdot\text{elev}+\texttt{rnorm(n=1, mu = 0, sd = .05)}\\
yB=0.8+0.15\cdot\text{elev}+\texttt{rnorm(n=1, mu = 0, sd = .05)}\\
\rightarrow y= 0.7+0.25\cdot\text{elev}+\texttt{(species == B)}\cdot(0.1-0.1\cdot\text{elev})+\texttt{rnorm(n=1, mu = 0, sd = .05)}
\]</span></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" tabindex="-1"></a>dfsim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y =</span> <span class="fu">c</span>(yA, yB),</span>
<span id="cb161-2"><a href="#cb161-2" tabindex="-1"></a>                    <span class="at">elev =</span> <span class="fu">c</span>(elev, elev),</span>
<span id="cb161-3"><a href="#cb161-3" tabindex="-1"></a>                    <span class="at">species =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="fu">length</span>(elev))))</span>
<span id="cb161-4"><a href="#cb161-4" tabindex="-1"></a>dfsim<span class="sc">$</span>x <span class="ot">&lt;-</span> dfsim<span class="sc">$</span>elev</span>
<span id="cb161-5"><a href="#cb161-5" tabindex="-1"></a><span class="do">## See: ?formula</span></span>
<span id="cb161-6"><a href="#cb161-6" tabindex="-1"></a>frmla <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(y <span class="sc">~</span> x <span class="sc">*</span> species)</span>
<span id="cb161-7"><a href="#cb161-7" tabindex="-1"></a><span class="fu">summary</span>(frmla)</span></code></pre></div>
<pre><code>##  Length   Class    Mode 
##       3 formula    call</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">model.matrix</span>(<span class="at">object =</span> frmla, <span class="at">data =</span> <span class="fu">subset</span>(dfsim, species <span class="sc">==</span> <span class="st">&quot;A&quot;</span>)))</span></code></pre></div>
<pre><code>##   (Intercept)    x speciesB x:speciesB
## 1           1 0.40        0          0
## 2           1 0.45        0          0
## 3           1 0.50        0          0
## 4           1 0.55        0          0
## 5           1 0.60        0          0
## 6           1 0.65        0          0</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">model.matrix</span>(<span class="at">object =</span> frmla, <span class="at">data =</span> <span class="fu">subset</span>(dfsim, species <span class="sc">==</span> <span class="st">&quot;B&quot;</span>)))</span></code></pre></div>
<pre><code>##    (Intercept)    x speciesB x:speciesB
## 30           1 0.40        1       0.40
## 31           1 0.45        1       0.45
## 32           1 0.50        1       0.50
## 33           1 0.55        1       0.55
## 34           1 0.60        1       0.60
## 35           1 0.65        1       0.65</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(frmla, <span class="at">data =</span> dfsim)</span>
<span id="cb167-2"><a href="#cb167-2" tabindex="-1"></a><span class="fu">coef</span>(m)</span></code></pre></div>
<pre><code>## (Intercept)           x    speciesB  x:speciesB 
##  0.73593782  0.21314912  0.09105386 -0.07786856</code></pre>
</div>
</div>
<div id="inspection-of-estimated-parameters" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Inspection of estimated parameters</h2>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;arm&quot;</span>)</span></code></pre></div>
<pre><code>## Lade nötiges Paket: MASS</code></pre>
<pre><code>## 
## Attache Paket: &#39;MASS&#39;</code></pre>
<pre><code>## Das folgende Objekt ist maskiert &#39;package:spatstat.geom&#39;:
## 
##     area</code></pre>
<pre><code>## Lade nötiges Paket: Matrix</code></pre>
<pre><code>## 
## Attache Paket: &#39;Matrix&#39;</code></pre>
<pre><code>## Das folgende Objekt ist maskiert &#39;package:lmfor&#39;:
## 
##     updown</code></pre>
<pre><code>## Lade nötiges Paket: lme4</code></pre>
<pre><code>## 
## Attache Paket: &#39;lme4&#39;</code></pre>
<pre><code>## Das folgende Objekt ist maskiert &#39;package:nlme&#39;:
## 
##     lmList</code></pre>
<pre><code>## 
## arm (Version 1.14-4, built: 2024-4-1)</code></pre>
<pre><code>## Working directory is /home/hsennhenn/Dropbox/Schreibtisch/oer_introduction_to_R_2024</code></pre>
<pre><code>## 
## Attache Paket: &#39;arm&#39;</code></pre>
<pre><code>## Das folgende Objekt ist maskiert &#39;package:spatstat.geom&#39;:
## 
##     rescale</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">sim</span>(m)</span>
<span id="cb183-2"><a href="#cb183-2" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp<span class="sc">@</span>coef, tmp<span class="sc">@</span>sigma)</span>
<span id="cb183-3"><a href="#cb183-3" tabindex="-1"></a><span class="fu">colnames</span>(B)[<span class="fu">ncol</span>(B)] <span class="ot">&lt;-</span> <span class="st">&quot;sigma&quot;</span></span>
<span id="cb183-4"><a href="#cb183-4" tabindex="-1"></a>df_draws <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;k&quot;</span> <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">colnames</span>(B), <span class="at">each =</span> <span class="fu">nrow</span>(B)), <span class="at">levels =</span> <span class="fu">colnames</span>(B)), </span>
<span id="cb183-5"><a href="#cb183-5" tabindex="-1"></a>                       <span class="st">&quot;value&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(B))</span>
<span id="cb183-6"><a href="#cb183-6" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df_draws, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb183-7"><a href="#cb183-7" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="predictive-check" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Predictive check</h2>
<p>For only one data-point:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="dv">1300</span> <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb184-2"><a href="#cb184-2" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>), <span class="at">levels =</span> <span class="fu">levels</span>(dfsim<span class="sc">$</span>species))</span>
<span id="cb184-3"><a href="#cb184-3" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(frmla[<span class="sc">-</span><span class="dv">2</span>], <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> elev, <span class="at">species =</span> species))</span>
<span id="cb184-4"><a href="#cb184-4" tabindex="-1"></a>X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)]</span></code></pre></div>
<pre><code>##       [,1]
## 1 1.015346</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)], <span class="at">sd =</span> B[<span class="dv">1</span>, <span class="fu">ncol</span>(B)])</span></code></pre></div>
<pre><code>##   [1] 0.9899480 1.1019713 1.0041147 1.0777084 1.0207939 1.0035805 1.0309227
##   [8] 0.9790030 1.0654185 0.9655213 1.0515324 1.0261213 1.0216022 1.0481515
##  [15] 0.9765463 0.9598976 1.0021634 1.0701242 1.0414169 1.1183507 0.9699917
##  [22] 1.0201318 1.1534332 1.0162380 1.0556141 1.0537146 1.0881090 1.0178440
##  [29] 1.0697926 0.9364685 0.9813849 1.0188523 0.9886918 1.0254739 0.9378543
##  [36] 1.0395219 0.9930987 0.9944408 1.0085548 0.9889237 0.9373617 1.0426293
##  [43] 1.0165602 0.8777181 1.0653720 0.9841040 1.0241862 1.0285470 0.9678332
##  [50] 0.9471550 1.0845774 1.1022373 1.0423772 1.0228742 1.0215433 1.0295161
##  [57] 1.0029881 1.0627028 1.0466847 0.9884676 1.0209400 1.0170410 1.0183230
##  [64] 1.0617957 0.9920905 1.0434989 1.0232035 1.0137752 1.0596489 1.0216063
##  [71] 0.9658334 0.9573625 0.9998750 0.9829873 0.9593663 0.9856021 0.9328536
##  [78] 0.9964383 0.9988052 1.0020665 1.0143018 1.0317154 0.9942652 1.0288297
##  [85] 0.9723134 1.0454983 1.0192867 1.0104133 0.9847446 1.0920802 1.0327738
##  [92] 1.0264920 0.8984973 0.9266750 1.0125771 1.0557838 1.0140788 0.9701887
##  [99] 1.0081371 0.9915109</code></pre>
<p>For the full data-frame:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(frmla[<span class="sc">-</span><span class="dv">2</span>], <span class="at">data =</span> dfsim)</span>
<span id="cb188-2"><a href="#cb188-2" tabindex="-1"></a><span class="fu">head</span>(X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)])</span></code></pre></div>
<pre><code>##        [,1]
## 1 0.8222726
## 2 0.8329990
## 3 0.8437253
## 4 0.8544516
## 5 0.8651779
## 6 0.8759042</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" tabindex="-1"></a><span class="fu">dim</span>(X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)])</span></code></pre></div>
<pre><code>## [1] 58  1</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" tabindex="-1"></a>Ytilde <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(B), <span class="at">ncol =</span> <span class="fu">nrow</span>(dfsim), <span class="cn">NA</span>)</span>
<span id="cb192-2"><a href="#cb192-2" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(B)) {</span>
<span id="cb192-3"><a href="#cb192-3" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> X <span class="sc">%*%</span> B[s, <span class="sc">-</span><span class="fu">ncol</span>(B)]</span>
<span id="cb192-4"><a href="#cb192-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dfsim)) {</span>
<span id="cb192-5"><a href="#cb192-5" tabindex="-1"></a>    Ytilde[s, i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> tmp[i, <span class="dv">1</span>], <span class="at">sd =</span> B[s, <span class="fu">ncol</span>(B)])</span>
<span id="cb192-6"><a href="#cb192-6" tabindex="-1"></a>  }</span>
<span id="cb192-7"><a href="#cb192-7" tabindex="-1"></a>}</span>
<span id="cb192-8"><a href="#cb192-8" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">apply</span>(Ytilde, <span class="at">MAR =</span> <span class="dv">1</span>, <span class="at">FUN =</span> density)</span>
<span id="cb192-9"><a href="#cb192-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">max</span>(x<span class="sc">$</span>y))}))), </span>
<span id="cb192-10"><a href="#cb192-10" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">min</span>(x<span class="sc">$</span>x))})), </span>
<span id="cb192-11"><a href="#cb192-11" tabindex="-1"></a>              <span class="fu">max</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">max</span>(x<span class="sc">$</span>x))}))), </span>
<span id="cb192-12"><a href="#cb192-12" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;(Predictive) Density&quot;</span>)</span>
<span id="cb192-13"><a href="#cb192-13" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> lines, <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">sequential_hcl</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)))</span>
<span id="cb192-14"><a href="#cb192-14" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(dfsim<span class="sc">$</span>y), <span class="at">lwd =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
<div id="model-component-mu" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Model component <code>mu</code></h2>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">400</span>, <span class="dv">1800</span>), <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb193-2"><a href="#cb193-2" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">each =</span> <span class="dv">2</span>), <span class="at">levels =</span> <span class="fu">levels</span>(dfsim<span class="sc">$</span>species))</span>
<span id="cb193-3"><a href="#cb193-3" tabindex="-1"></a>(X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(frmla[<span class="sc">-</span><span class="dv">2</span>], <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> elev, <span class="at">species =</span> species)))</span></code></pre></div>
<pre><code>##   (Intercept)   x speciesB x:speciesB
## 1           1 0.4        0        0.0
## 2           1 1.8        0        0.0
## 3           1 0.4        1        0.4
## 4           1 1.8        1        1.8
## attr(,&quot;assign&quot;)
## [1] 0 1 2 3
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$species
## [1] &quot;contr.treatment&quot;</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(B), <span class="at">ncol =</span> <span class="fu">nrow</span>(X), <span class="cn">NA</span>)</span>
<span id="cb195-2"><a href="#cb195-2" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(B)) {</span>
<span id="cb195-3"><a href="#cb195-3" tabindex="-1"></a>  Mu[s, ] <span class="ot">&lt;-</span> X <span class="sc">%*%</span> B[s, <span class="sc">-</span><span class="fu">ncol</span>(B)]</span>
<span id="cb195-4"><a href="#cb195-4" tabindex="-1"></a>}</span>
<span id="cb195-5"><a href="#cb195-5" tabindex="-1"></a>paint <span class="ot">&lt;-</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)</span>
<span id="cb195-6"><a href="#cb195-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">range</span>(elev), <span class="fu">range</span>(Mu), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">&quot;Elev [m/1000]&quot;</span>, </span>
<span id="cb195-7"><a href="#cb195-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Model component &#39;mu&#39;&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb195-8"><a href="#cb195-8" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Mu)) {</span>
<span id="cb195-9"><a href="#cb195-9" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">range</span>(elev), Mu[s, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">col =</span> paint[<span class="dv">1</span>])</span>
<span id="cb195-10"><a href="#cb195-10" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">range</span>(elev), Mu[s, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">col =</span> paint[<span class="dv">2</span>])</span>
<span id="cb195-11"><a href="#cb195-11" tabindex="-1"></a>}</span>
<span id="cb195-12"><a href="#cb195-12" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), .<span class="dv">7</span> <span class="sc">+</span> .<span class="dv">25</span> <span class="sc">*</span> <span class="fu">range</span>(elev), <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb195-13"><a href="#cb195-13" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), .<span class="dv">8</span> <span class="sc">+</span> .<span class="dv">15</span> <span class="sc">*</span> <span class="fu">range</span>(elev), <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb195-14"><a href="#cb195-14" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), <span class="fu">coef</span>(m)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">range</span>(elev), <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb195-15"><a href="#cb195-15" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), <span class="fu">coef</span>(m)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">3</span>] <span class="sc">+</span> (<span class="fu">coef</span>(m)[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">4</span>]) <span class="sc">*</span> <span class="fu">range</span>(elev), </span>
<span id="cb195-16"><a href="#cb195-16" tabindex="-1"></a>      <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
<div id="real-data" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Real data</h2>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" tabindex="-1"></a>drought<span class="sc">$</span>x <span class="ot">&lt;-</span> drought<span class="sc">$</span>elev <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb196-2"><a href="#cb196-2" tabindex="-1"></a>drought<span class="sc">$</span>y <span class="ot">&lt;-</span> drought<span class="sc">$</span>bair</span>
<span id="cb196-3"><a href="#cb196-3" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(frmla, <span class="at">data =</span> drought)</span>
<span id="cb196-4"><a href="#cb196-4" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">sim</span>(m)</span>
<span id="cb196-5"><a href="#cb196-5" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tmp<span class="sc">@</span>coef, tmp<span class="sc">@</span>sigma)</span></code></pre></div>
<div id="predictive-check-1" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> Predictive check</h3>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(frmla[<span class="sc">-</span><span class="dv">2</span>], <span class="at">data =</span> drought)</span>
<span id="cb197-2"><a href="#cb197-2" tabindex="-1"></a><span class="fu">head</span>(X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)])</span></code></pre></div>
<pre><code>##        [,1]
## 1 0.4047765
## 2 0.4672026
## 3 0.4771908
## 4 0.4946701
## 5 0.5071554
## 6 0.5620903</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" tabindex="-1"></a><span class="fu">dim</span>(X <span class="sc">%*%</span> B[<span class="dv">1</span>, <span class="sc">-</span><span class="fu">ncol</span>(B)])</span></code></pre></div>
<pre><code>## [1] 34  1</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" tabindex="-1"></a>Ytilde <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(B), <span class="at">ncol =</span> <span class="fu">nrow</span>(drought), <span class="cn">NA</span>)</span>
<span id="cb201-2"><a href="#cb201-2" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(B)) {</span>
<span id="cb201-3"><a href="#cb201-3" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> X <span class="sc">%*%</span> B[s, <span class="sc">-</span><span class="fu">ncol</span>(B)]</span>
<span id="cb201-4"><a href="#cb201-4" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(drought)) {</span>
<span id="cb201-5"><a href="#cb201-5" tabindex="-1"></a>    Ytilde[s, i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> tmp[i, <span class="dv">1</span>], <span class="at">sd =</span> B[s, <span class="fu">ncol</span>(B)])</span>
<span id="cb201-6"><a href="#cb201-6" tabindex="-1"></a>  }</span>
<span id="cb201-7"><a href="#cb201-7" tabindex="-1"></a>}</span>
<span id="cb201-8"><a href="#cb201-8" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">apply</span>(Ytilde, <span class="at">MAR =</span> <span class="dv">1</span>, <span class="at">FUN =</span> density)</span>
<span id="cb201-9"><a href="#cb201-9" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">max</span>(x<span class="sc">$</span>y))}))), </span>
<span id="cb201-10"><a href="#cb201-10" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">min</span>(x<span class="sc">$</span>x))})), </span>
<span id="cb201-11"><a href="#cb201-11" tabindex="-1"></a>              <span class="fu">max</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">max</span>(x<span class="sc">$</span>x))}))), </span>
<span id="cb201-12"><a href="#cb201-12" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;(Predictive) Density&quot;</span>)</span>
<span id="cb201-13"><a href="#cb201-13" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(tmp, <span class="at">FUN =</span> lines, <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">sequential_hcl</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)))</span>
<span id="cb201-14"><a href="#cb201-14" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(drought<span class="sc">$</span>y), <span class="at">lwd =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="model-component-mu-1" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> Model component <code>mu</code></h3>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">400</span>, <span class="dv">1800</span>), <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">1000</span></span>
<span id="cb202-2"><a href="#cb202-2" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">levels</span>(drought<span class="sc">$</span>species), <span class="at">each =</span> <span class="dv">2</span>), <span class="at">levels =</span> <span class="fu">levels</span>(drought<span class="sc">$</span>species))</span>
<span id="cb202-3"><a href="#cb202-3" tabindex="-1"></a>(X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(frmla[<span class="sc">-</span><span class="dv">2</span>], <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> elev, <span class="at">species =</span> species)))</span></code></pre></div>
<pre><code>##   (Intercept)   x speciesSpruce x:speciesSpruce
## 1           1 0.4             0             0.0
## 2           1 1.8             0             0.0
## 3           1 0.4             1             0.4
## 4           1 1.8             1             1.8
## attr(,&quot;assign&quot;)
## [1] 0 1 2 3
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$species
## [1] &quot;contr.treatment&quot;</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(B), <span class="at">ncol =</span> <span class="fu">nrow</span>(X), <span class="cn">NA</span>)</span>
<span id="cb204-2"><a href="#cb204-2" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(B)) {</span>
<span id="cb204-3"><a href="#cb204-3" tabindex="-1"></a>  Mu[s, ] <span class="ot">&lt;-</span> X <span class="sc">%*%</span> B[s, <span class="sc">-</span><span class="fu">ncol</span>(B)]</span>
<span id="cb204-4"><a href="#cb204-4" tabindex="-1"></a>}</span>
<span id="cb204-5"><a href="#cb204-5" tabindex="-1"></a>paint <span class="ot">&lt;-</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)</span>
<span id="cb204-6"><a href="#cb204-6" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">range</span>(elev), <span class="fu">range</span>(Mu), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">xlab =</span> <span class="st">&quot;Elevation [m/1000]&quot;</span>, </span>
<span id="cb204-7"><a href="#cb204-7" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Model component &#39;mu&#39;&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb204-8"><a href="#cb204-8" tabindex="-1"></a><span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Mu)) {</span>
<span id="cb204-9"><a href="#cb204-9" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">range</span>(elev), Mu[s, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">col =</span> paint[<span class="dv">1</span>])</span>
<span id="cb204-10"><a href="#cb204-10" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">range</span>(elev), Mu[s, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">col =</span> paint[<span class="dv">2</span>])</span>
<span id="cb204-11"><a href="#cb204-11" tabindex="-1"></a>}</span>
<span id="cb204-12"><a href="#cb204-12" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), <span class="fu">coef</span>(m)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">range</span>(elev), <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb204-13"><a href="#cb204-13" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">range</span>(elev), <span class="fu">coef</span>(m)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">3</span>] <span class="sc">+</span> (<span class="fu">coef</span>(m)[<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">coef</span>(m)[<span class="dv">4</span>]) <span class="sc">*</span> <span class="fu">range</span>(elev), </span>
<span id="cb204-14"><a href="#cb204-14" tabindex="-1"></a>      <span class="at">col =</span> colorspace<span class="sc">::</span><span class="fu">qualitative_hcl</span>(<span class="at">n =</span> <span class="dv">2</span>)[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="intro_to_R_2024_session_04_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Private webpage: <a href="https://uncertaintree.github.io">uncertaintree.github.io</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": false,
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["intro_to_R_session_04.pdf", "PDF"]],
"search": false,
"toc": {
"collapse": "subsubsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
