<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Introduction to R: Session 03</title>
  <meta name="description" content="Introduction to R: Session 03" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Introduction to R: Session 03" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to R: Session 03" />
  
  
  

<meta name="author" content="Holger Sennhenn-Reulen, Nordwestdeutsche Forstliche Versuchsanstalt (NW-FVA)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style_gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#objectives-of-control-structures."><i class="fa fa-check"></i><b>1</b> Objectives of control structures.</a></li>
<li class="chapter" data-level="2" data-path=""><a href="#logical-comparisons."><i class="fa fa-check"></i><b>2</b> Logical comparisons.</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#exercises"><i class="fa fa-check"></i><b>2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#conditional-execution"><i class="fa fa-check"></i><b>3</b> Conditional execution</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#if-else"><i class="fa fa-check"></i><b>3.1</b> <code>if () { } else { }</code></a><ul>
<li class="chapter" data-level="3.1.1" data-path=""><a href="#exercises-1"><i class="fa fa-check"></i><b>3.1.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#for-loops"><i class="fa fa-check"></i><b>3.2</b> <code>for</code>-loops</a><ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#exercises-2"><i class="fa fa-check"></i><b>3.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#example-of-a-for-loop-with-if"><i class="fa fa-check"></i><b>3.3</b> Example of a <code>for</code> loop with <code>if</code></a><ul>
<li class="chapter" data-level="3.3.1" data-path=""><a href="#illustrating-the-loop-index"><i class="fa fa-check"></i><b>3.3.1</b> Illustrating the loop index</a></li>
<li class="chapter" data-level="3.3.2" data-path=""><a href="#an-iteration-by-hand"><i class="fa fa-check"></i><b>3.3.2</b> An iteration ‘by hand’</a></li>
<li class="chapter" data-level="3.3.3" data-path=""><a href="#the-full-loop"><i class="fa fa-check"></i><b>3.3.3</b> The ‘full’ loop</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#while-loops."><i class="fa fa-check"></i><b>3.4</b> <code>while</code>-loops.</a><ul>
<li class="chapter" data-level="3.4.1" data-path=""><a href="#example-1"><i class="fa fa-check"></i><b>3.4.1</b> Example 1</a></li>
<li class="chapter" data-level="3.4.2" data-path=""><a href="#example-2"><i class="fa fa-check"></i><b>3.4.2</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path=""><a href="#apply-commands"><i class="fa fa-check"></i><b>3.5</b> <code>apply</code>-commands</a><ul>
<li class="chapter" data-level="3.5.1" data-path=""><a href="#exercises-3"><i class="fa fa-check"></i><b>3.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path=""><a href="#plyrddply-splitapplycombine"><i class="fa fa-check"></i><b>3.6</b> <code>plyr::ddply</code>: ’split–apply–combine</a></li>
<li class="chapter" data-level="3.7" data-path=""><a href="#pragmatic-programming."><i class="fa fa-check"></i><b>3.7</b> Pragmatic Programming.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#define-your-own-functions."><i class="fa fa-check"></i><b>4</b> Define your own functions.</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#naming-conventions-for-arguments."><i class="fa fa-check"></i><b>4.1</b> Naming conventions for arguments.</a></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#content-and-result."><i class="fa fa-check"></i><b>4.2</b> <code>content</code> and <code>result</code>.</a></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#exercises-4"><i class="fa fa-check"></i><b>4.3</b> Exercises</a><ul>
<li class="chapter" data-level="4.3.1" data-path=""><a href="#environments-and-scoping"><i class="fa fa-check"></i><b>4.3.1</b> Environments and scoping</a></li>
<li class="chapter" data-level="4.3.2" data-path=""><a href="#closure"><i class="fa fa-check"></i><b>4.3.2</b> Closure</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path=""><a href="#real-world-helpers"><i class="fa fa-check"></i><b>4.4</b> Real-world helpers</a><ul>
<li class="chapter" data-level="4.4.1" data-path=""><a href="#drop_ghosts"><i class="fa fa-check"></i><b>4.4.1</b> <code>drop_ghosts</code></a></li>
<li class="chapter" data-level="4.4.2" data-path=""><a href="#overlap_seq"><i class="fa fa-check"></i><b>4.4.2</b> <code>overlap_seq</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>Introduction to R: Session 03</strong></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title"><strong>Introduction to R: Session 03</strong></h1>
<p class="author"><em>Holger Sennhenn-Reulen<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, Nordwestdeutsche Forstliche Versuchsanstalt (NW-FVA)</em></p>
<p class="date" style="margin-top: 1.5em;"><em>November 8, 2021 (Version 0.4)</em></p>
</div>
<!--# About this course{-}
This course introduces basic R-programming skills needed for applied statistical modeling in R.-->
<p>All contents are licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>.</p>
<div id="objectives-of-control-structures." class="section level1">
<h1><span class="header-section-number">1</span> Objectives of control structures.</h1>
<p><strong>‘Automation’ of the repetition of structurally identical commands.</strong></p>
<ul>
<li>Repetition of a command – with objects remaining the same, or changing – with a predetermined or flexible number of repetitions.</li>
<li>Conditional execution of various tasks.</li>
<li>Generalization of tasks by defining functions.
<!--- Combination of information in objects.--></li>
</ul>
</div>
<div id="logical-comparisons." class="section level1">
<h1><span class="header-section-number">2</span> Logical comparisons.</h1>
<table>
<thead>
<tr class="header">
<th align="left">Command</th>
<th align="left"><code>TRUE</code> if:</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>==</code></td>
<td align="left">Equality</td>
</tr>
<tr class="even">
<td align="left"><code>!=</code> I</td>
<td align="left">nequality</td>
</tr>
<tr class="odd">
<td align="left"><code>&gt;</code>, <code>&gt;=</code></td>
<td align="left">Left side greater than (or equal to) the right side</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;</code>, <code>&lt;=</code></td>
<td align="left">Left side less than (or equal to) the right side</td>
</tr>
<tr class="odd">
<td align="left"><code>%in%</code></td>
<td align="left">Is left side in vector on right side?</td>
</tr>
</tbody>
</table>
<ul>
<li><code>all()</code> returns <code>TRUE</code> if all elements of the vector are <code>TRUE</code>.</li>
<li><code>any()</code> returns <code>TRUE</code> if at least one element of the vector is <code>TRUE</code>.</li>
<li><code>is.na()</code> and <code>is.null()</code> return <code>TRUE</code> if the respective object (e.g. element of a vector) is <code>NA</code> or <code>NULL</code>.</li>
<li>A logical value can be negated with a preceding <code>!</code> (e.g. <code>!TRUE</code> is <code>FALSE</code>)</li>
<li><code>which()</code> returns the index set (as an integer vector) if the logical comparison resulted in <code>TRUE</code>.</li>
</ul>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">2.1</span> Exercises</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">is.na</span>(drought<span class="op">$</span>bair)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">any</span>(<span class="kw">is.na</span>(drought<span class="op">$</span>bair))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">all</span>(drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">any</span>(drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">all</span>(drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">which</span>(drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">drought<span class="op">$</span>bair[<span class="kw">which</span>(drought<span class="op">$</span>bair <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)]</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">(tmp &lt;-<span class="st"> </span><span class="kw">round</span>(drought<span class="op">$</span>bair, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>) <span class="op">%in%</span><span class="st"> </span>tmp</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>) <span class="op">%in%</span><span class="st"> </span>drought<span class="op">$</span>bair</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">which</span>(tmp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>))</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">drought<span class="op">$</span>bair[<span class="kw">which</span>(tmp <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>))]</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">tmp &lt;-<span class="st"> </span><span class="kw">c</span>(drought<span class="op">$</span>bair[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="kw">all</span>(tmp <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="kw">any</span>(<span class="kw">is.na</span>(tmp))</a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw">which</span>(<span class="kw">is.na</span>(tmp))</a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="kw">all</span>(tmp[<span class="op">-</span><span class="kw">which</span>(<span class="kw">is.na</span>(tmp))] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="kw">mean</span>(tmp)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="kw">mean</span>(tmp, <span class="dt">na.rm =</span> T)</a></code></pre></div>
</div>
</div>
<div id="conditional-execution" class="section level1">
<h1><span class="header-section-number">3</span> Conditional execution</h1>
<div id="if-else" class="section level2">
<h2><span class="header-section-number">3.1</span> <code>if () { } else { }</code></h2>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">if</span> (condition) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  ... <span class="co">## Commands if condition is TRUE</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  ... <span class="co">## Commands if condition is FALSE</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">}</a></code></pre></div>
<ul>
<li><code>TRUE</code> or <code>FALSE</code> condition necessary.</li>
<li>‘if-else’-sequences can be nested within one another.</li>
</ul>
<p><strong>Applied example together with the next topic.</strong></p>
<div id="exercises-1" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Exercises</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">a &lt;-<span class="st"> </span>drought<span class="op">$</span>bair[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="cf">if</span> (a <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="kw">print</span>(<span class="st">&quot;a is greater than 1.&quot;</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="kw">print</span>(<span class="st">&quot;a is not greater than 1.&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">index &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">tmp &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(drought))</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="cf">if</span> (drought<span class="op">$</span>bair[index] <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  result &lt;-<span class="st"> &quot;bair&lt;1&quot;</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  <span class="cf">if</span> (drought<span class="op">$</span>elev[index] <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>) {</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    tmp[index] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;1_&quot;</span>, result, <span class="st">&quot;,elev&lt;1000&quot;</span>)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    tmp[index] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;2_&quot;</span>, result, <span class="st">&quot;,elev&gt;=1000&quot;</span>)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">  result &lt;-<span class="st"> &quot;bair&gt;=1&quot;</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">  <span class="cf">if</span> (drought<span class="op">$</span>elev[index] <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>) {</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">    tmp[index] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;3_&quot;</span>, result, <span class="st">&quot;,elev&lt;1000&quot;</span>)</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    tmp[index] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;4_&quot;</span>, result, <span class="st">&quot;,elev&gt;=1000&quot;</span>)</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">tmp</a></code></pre></div>
</div>
</div>
<div id="for-loops" class="section level2">
<h2><span class="header-section-number">3.2</span> <code>for</code>-loops</h2>
<p><code>for</code> loops often offer a simple and pragmatic way to complete steps in data management / preparation.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="cf">for</span> (index <span class="cf">in</span> vector) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  ... index ... <span class="co">## Commands that in some form depend on index.</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">}</a></code></pre></div>
<ul>
<li>New object <code>index</code> runs all elements in <code>vector</code>.</li>
<li><code>index</code> remains constant during <code>... index ...</code></li>
<li><code>index</code> jumps to the next (if available) value of <code>vector</code> after running through <code>... index ...</code>.</li>
<li><code>index</code> takes each value of <code>vector</code> once.</li>
<li>The number of iterations of <code>... index ...</code> is determined by the length of <code>vector</code>.</li>
</ul>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Exercises</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">tmp1 &lt;-<span class="st"> </span>frost<span class="op">$</span>bud_burst_days_since_may1st</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">tmp2 &lt;-<span class="st"> </span>frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">days_since_may1st &lt;-<span class="st"> </span><span class="kw">min</span>(tmp1)<span class="op">:</span><span class="kw">max</span>(tmp2)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">rm</span>(tmp1, tmp2)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw">plot</span>(frost<span class="op">$</span>year, frost<span class="op">$</span>bud_burst_days_since_may1st, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">     <span class="dt">ylim =</span> <span class="kw">range</span>(days_since_may1st), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(frost)) {</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  tmp_x &lt;-<span class="st"> </span><span class="kw">rep</span>(frost<span class="op">$</span>year[index], <span class="dt">times =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  tmp_y &lt;-<span class="st"> </span><span class="kw">c</span>(frost<span class="op">$</span>bud_burst_days_since_may1st[index], </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">             frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st[index])</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  <span class="kw">lines</span>(<span class="dt">x =</span> tmp_x, <span class="dt">y =</span> tmp_y)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">}</a></code></pre></div>
</div>
</div>
<div id="example-of-a-for-loop-with-if" class="section level2">
<h2><span class="header-section-number">3.3</span> Example of a <code>for</code> loop with <code>if</code></h2>
<p>The goal of this example is to get to know which day in May is the one at which a young Douglas fir was most often in the first development stage.</p>
<p>As a preparation, we nee to set up a data-frame as the object that will carry the result:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">tmp1 &lt;-<span class="st"> </span>frost<span class="op">$</span>bud_burst_days_since_may1st</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">tmp2 &lt;-<span class="st"> </span>frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">days_since_may1st &lt;-<span class="st"> </span><span class="kw">min</span>(tmp1)<span class="op">:</span><span class="kw">max</span>(tmp2)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">rm</span>(tmp1, tmp2)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">res &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">days_since_may1st =</span> days_since_may1st, </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                  <span class="dt">n_at_risk =</span> <span class="ot">NA</span>)</a></code></pre></div>
<div id="illustrating-the-loop-index" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Illustrating the loop index</h3>
<p>The foor loop will run thorugh our resulting data-frame <code>res</code>, line by line.
We can try and illustrate this with the following graph, where the x-axis carries the values of the loop-index, and the y-axis the value of the <code>days_since_may1st</code> variable that will be taken in each of the loop’s <code>... index ...</code> circles.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">paint &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">divergingx_hcl</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(res), <span class="dt">pal =</span> <span class="st">&quot;Zissou&quot;</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(res), res<span class="op">$</span>days_since_may1st, <span class="dt">col =</span> paint, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb7-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;for-loop index &#39;index&#39;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;res$days_since_may1st at &#39;index&#39;&quot;</span>)</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="an-iteration-by-hand" class="section level3">
<h3><span class="header-section-number">3.3.2</span> An iteration ‘by hand’</h3>
<p>We can run a first iteration by hand that does what <code>... index ...</code> should do in our loop:
compare the current – at <code>index = 1</code>– <code>res$days_since_may1st</code> value to each of the first development stage periods that are given by <code>frost$bud_burst_days_since_may1st</code>and <code>frost$end_1st_dev_stage_days_since_may1st</code>.
If any of those periods covers our current day, than at least a value of <code>1</code> will result for <code>res$n_at_risk[index]</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">plot</span>(frost<span class="op">$</span>year, frost<span class="op">$</span>bud_burst_days_since_may1st, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">     <span class="dt">ylim =</span> <span class="kw">range</span>(days_since_may1st), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(frost)) { <span class="co">## here, the uninteresting loop</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  tmp_x &lt;-<span class="st"> </span><span class="kw">rep</span>(frost<span class="op">$</span>year[index], <span class="dt">times =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  tmp_y &lt;-<span class="st"> </span><span class="kw">c</span>(frost<span class="op">$</span>bud_burst_days_since_may1st[index], </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">             frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st[index])</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="kw">lines</span>(<span class="dt">x =</span> tmp_x, <span class="dt">y =</span> tmp_y)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">index &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="kw">abline</span>(<span class="dt">h =</span> res<span class="op">$</span>days_since_may1st[index], <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">## boolean 1 and 2:</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">bool1 &lt;-<span class="st"> </span>frost<span class="op">$</span>bud_burst_days_since_may1st <span class="op">&lt;=</span><span class="st"> </span>res<span class="op">$</span>days_since_may1st[index]</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">bool2 &lt;-<span class="st"> </span>frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st <span class="op">&gt;=</span><span class="st"> </span>res<span class="op">$</span>days_since_may1st[index]</a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">## if any ... else ...</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="cf">if</span> (<span class="kw">any</span>(bool1 <span class="op">&amp;</span><span class="st"> </span>bool2)) {</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">  which_true &lt;-<span class="st"> </span><span class="kw">which</span>(bool1 <span class="op">&amp;</span><span class="st"> </span>bool2)</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  <span class="kw">points</span>(frost<span class="op">$</span>year[which_true], </a>
<a class="sourceLine" id="cb8-19" data-line-number="19">         <span class="kw">rep</span>(days_since_may1st[index], <span class="dt">times =</span> <span class="kw">length</span>(which_true)), </a>
<a class="sourceLine" id="cb8-20" data-line-number="20">         <span class="dt">col =</span> paint[index], <span class="dt">pch =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">  res<span class="op">$</span>n_at_risk[index] &lt;-<span class="st"> </span><span class="kw">length</span>(which_true)</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">  res<span class="op">$</span>n_at_risk[index] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24">}</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">rm</span>(index)</a></code></pre></div>
</div>
<div id="the-full-loop" class="section level3">
<h3><span class="header-section-number">3.3.3</span> The ‘full’ loop</h3>
<p>Now we just take what we have implemented before and – by using <code>for (index in 1:nrow(res)) {</code> effortlessly run through all the lines of <code>res</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">plot</span>(frost<span class="op">$</span>year, frost<span class="op">$</span>bud_burst_days_since_may1st, <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">     <span class="dt">ylim =</span> <span class="kw">range</span>(days_since_may1st), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(frost)) { <span class="co">## here, the uninteresting loop</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  tmp_x &lt;-<span class="st"> </span><span class="kw">rep</span>(frost<span class="op">$</span>year[index], <span class="dt">times =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  tmp_y &lt;-<span class="st"> </span><span class="kw">c</span>(frost<span class="op">$</span>bud_burst_days_since_may1st[index], </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">             frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st[index])</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">  <span class="kw">lines</span>(<span class="dt">x =</span> tmp_x, <span class="dt">y =</span> tmp_y)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(res)) { <span class="co">## here, the interesting loop</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  <span class="kw">abline</span>(<span class="dt">h =</span> res<span class="op">$</span>days_since_may1st[index], <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  bool1 &lt;-<span class="st"> </span>frost<span class="op">$</span>bud_burst_days_since_may1st <span class="op">&lt;=</span><span class="st"> </span>days_since_may1st[index]</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">  bool2 &lt;-<span class="st"> </span>frost<span class="op">$</span>end_1st_dev_stage_days_since_may1st <span class="op">&gt;=</span><span class="st"> </span>days_since_may1st[index]</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  <span class="co">## if any ... else ...</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15">  <span class="cf">if</span> (<span class="kw">any</span>(bool1 <span class="op">&amp;</span><span class="st"> </span>bool2)) {</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">    which_true &lt;-<span class="st"> </span><span class="kw">which</span>(bool1 <span class="op">&amp;</span><span class="st"> </span>bool2)</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">    <span class="kw">points</span>(frost<span class="op">$</span>year[which_true], </a>
<a class="sourceLine" id="cb10-18" data-line-number="18">           <span class="kw">rep</span>(days_since_may1st[index], <span class="dt">times =</span> <span class="kw">length</span>(which_true)), </a>
<a class="sourceLine" id="cb10-19" data-line-number="19">           <span class="dt">col =</span> paint[index], <span class="dt">pch =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb10-20" data-line-number="20">    res<span class="op">$</span>n_at_risk[index] &lt;-<span class="st"> </span><span class="kw">length</span>(which_true)</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">    res<span class="op">$</span>n_at_risk[index] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb10-24" data-line-number="24">}</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">head</span>(res, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##    days_since_may1st n_at_risk
## 1                 -4         1
## 2                 -3         1
## 3                 -2         1
## 4                 -1         3
## 5                  0         5
## 6                  1         5
## 7                  2         5
## 8                  3         8
## 9                  4        11
## 10                 5        12</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="fl">.1</span>, <span class="fl">.1</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">plot</span>(res<span class="op">$</span>days_since_may1st, res<span class="op">$</span>n_at_risk, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">grid</span>()</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="while-loops." class="section level2">
<h2><span class="header-section-number">3.4</span> <code>while</code>-loops.</h2>
<p><code>while</code> loops are used less often in data management / preparation, but are more likely to be found in computationally intensive applications (e.g. for optimization).</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">index &lt;-<span class="st"> </span>k <span class="co">## &#39;k&#39; here has to be smaller than &#39;K&#39; in next line.</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="cf">while</span> (index <span class="op">&lt;</span><span class="st"> </span>K){</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  ...</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  index &lt;-<span class="st"> </span>index <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">}</a></code></pre></div>
<ul>
<li>The commands that ’<code>...</code> stands for, and the following line, are repeated as long as the condition is <code>TRUE</code> (i.e. here as long as <code>k</code><span class="math inline">\(&lt;\)</span><code>K</code>).</li>
<li>flexible number of repetitions.</li>
<li>stops immediately after the condition – <code>index &lt; K</code> in the above usage example – is no longer met, ie. is <code>FALSE</code> for the first time.</li>
</ul>
<p><em>The following two examples are two applications of a while-loop that came into my mind. They might be a bit too distracting from the goals of ‘Introduction to R’, so feel completely free to skip them …</em></p>
<div id="example-1" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Example 1</h3>
<p>This example does Bayesian inference for a simple one parameter model – estimation of an unknown quantity which is a proportion between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> – by filtering the prior proposals that lead to the simulated data that are equal to the data sample – the likelihood works as some sort of sieve here.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">accepted &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">xtabs</span>(<span class="op">~</span><span class="st"> </span>(frost<span class="op">$</span>n_frost <span class="op">&gt;</span><span class="st"> </span><span class="fl">.5</span>))</a></code></pre></div>
<pre><code>## frost$n_frost &gt; 0.5
## FALSE  TRUE 
##    63    12</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">prior &lt;-<span class="st"> </span>post &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="cf">while</span> (accepted <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000</span>) {</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  p &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">shape1 =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dt">shape2 =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="co">## http://dx.doi.org/10.1214/11-EJS648</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  prior &lt;-<span class="st"> </span><span class="kw">c</span>(prior, p)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  y_tilde &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dt">size =</span> <span class="kw">nrow</span>(frost), <span class="dt">replace =</span> T, </a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                    <span class="dt">prob =</span> <span class="kw">c</span>(p, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p))</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="cf">if</span> (<span class="kw">sum</span>(y_tilde) <span class="op">==</span><span class="st"> </span><span class="kw">sum</span>(frost<span class="op">$</span>n_frost <span class="op">&gt;</span><span class="st"> </span><span class="fl">.5</span>)) {</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">    accepted &lt;-<span class="st"> </span>accepted <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    post &lt;-<span class="st"> </span><span class="kw">c</span>(post, p)</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="kw">length</span>(post)</a></code></pre></div>
<pre><code>## [1] 1000</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">length</span>(prior)</a></code></pre></div>
<pre><code>## [1] 105721</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">length</span>(post) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(prior)</a></code></pre></div>
<pre><code>## [1] 0.009458859</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">summary</span>(post)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.06021 0.13146 0.16123 0.16335 0.19122 0.31806</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">summary</span>(prior)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.08147 0.49555 0.49895 0.91785 1.00000</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.025</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">paint &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">qualitative_hcl</span>(<span class="dt">n =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">paint_a &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">qualitative_hcl</span>(<span class="dt">n =</span> <span class="dv">3</span>, <span class="dt">alpha =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.5</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.4</span>)</a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="kw">hist</span>(post, <span class="dt">breaks =</span> b, <span class="dt">freq =</span> F, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">col =</span> paint_a[<span class="dv">1</span>], <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, </a>
<a class="sourceLine" id="cb27-6" data-line-number="6">     <span class="dt">xlab =</span> <span class="st">&quot;Prob. for an late frost event&quot;</span>)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">hist</span>(prior, <span class="dt">breaks =</span> b, <span class="dt">freq =</span> F, <span class="dt">add =</span> T, <span class="dt">col =</span> paint_a[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">sum</span>(frost<span class="op">$</span>n_frost <span class="op">&gt;</span><span class="st"> </span><span class="fl">.5</span>) <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(frost), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> paint[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">median</span>(post), <span class="dt">col =</span> paint[<span class="dv">2</span>], <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="dt">fill =</span> <span class="kw">c</span>(paint_a[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)], <span class="ot">NA</span>, <span class="ot">NA</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, paint[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]), </a>
<a class="sourceLine" id="cb27-11" data-line-number="11">       <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">border =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">       <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Posterior&quot;</span>, <span class="st">&quot;Prior&quot;</span>, <span class="st">&quot;Posterior median&quot;</span>, <span class="st">&quot;Sample mean&quot;</span>))</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="example-2" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Example 2</h3>
<p>This example implements a very primitive <em>component-wise ‘L[2]-loss descent’ boosting</em> (comparable to what add-on package <code>mboost</code> implements for a normally distributed response).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">x1 &lt;-<span class="st"> </span>drought<span class="op">$</span>elev <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(drought<span class="op">$</span>elev)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">x2 &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="kw">nrow</span>(drought), <span class="dt">min =</span> <span class="kw">min</span>(x1), <span class="dt">max =</span> <span class="kw">max</span>(x1))</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">x2 &lt;-<span class="st"> </span>x2 <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x2)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">y &lt;-<span class="st"> </span>drought<span class="op">$</span>bair<span class="co">#  - mean(drought$bair)</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">f_y_work &lt;-<span class="st"> </span><span class="cf">function</span>(y, x1, x2, b0, b1, b2){<span class="op">-</span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span>y <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(b0 <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>x1 <span class="op">+</span><span class="st"> </span>b2<span class="op">*</span>x2))}</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">b0 &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8">b1 &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">b2 &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">krit_diff &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">## Initialisierung irgendwie so dass Bedingung am Anfang wahr ist.</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">krit_alt &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(<span class="kw">c</span>(y <span class="op">-</span><span class="st"> </span>(b0 <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>x1 <span class="op">+</span><span class="st"> </span>b2<span class="op">*</span>x2))<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">component &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="cf">while</span> (krit_diff <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.0001</span>) { <span class="co">## Beginn der while-Schleife.</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14">  y_work &lt;-<span class="st"> </span><span class="kw">f_y_work</span>(<span class="dt">y =</span> y, <span class="dt">x1 =</span> x1, <span class="dt">x2 =</span> x2, </a>
<a class="sourceLine" id="cb28-15" data-line-number="15">                     <span class="dt">b0 =</span> b0[<span class="kw">length</span>(b0)], <span class="dt">b1 =</span> b1[<span class="kw">length</span>(b1)], </a>
<a class="sourceLine" id="cb28-16" data-line-number="16">                     <span class="dt">b2 =</span> b2[<span class="kw">length</span>(b2)])</a>
<a class="sourceLine" id="cb28-17" data-line-number="17">  lm_b0 &lt;-<span class="st"> </span><span class="kw">lm</span>(y_work <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">  lm_b1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y_work <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>x1)</a>
<a class="sourceLine" id="cb28-19" data-line-number="19">  lm_b2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y_work <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>x2)</a>
<a class="sourceLine" id="cb28-20" data-line-number="20">  krit_b0 &lt;-<span class="st"> </span><span class="kw">mean</span>(lm_b0<span class="op">$</span>residuals<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-21" data-line-number="21">  krit_b1 &lt;-<span class="st"> </span><span class="kw">mean</span>(lm_b1<span class="op">$</span>residuals<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-22" data-line-number="22">  krit_b2 &lt;-<span class="st"> </span><span class="kw">mean</span>(lm_b2<span class="op">$</span>residuals<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb28-23" data-line-number="23">  selected &lt;-<span class="st"> </span><span class="kw">which.min</span>(<span class="kw">c</span>(krit_b0, krit_b1, krit_b2))</a>
<a class="sourceLine" id="cb28-24" data-line-number="24">  update_weight &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb28-25" data-line-number="25">  update_weight[selected] &lt;-<span class="st"> </span><span class="fl">.01</span></a>
<a class="sourceLine" id="cb28-26" data-line-number="26">  b0 &lt;-<span class="st"> </span><span class="kw">c</span>(b0, b0[<span class="kw">length</span>(b0)] <span class="op">+</span><span class="st"> </span>update_weight[<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span><span class="kw">coef</span>(lm_b0))</a>
<a class="sourceLine" id="cb28-27" data-line-number="27">  b1 &lt;-<span class="st"> </span><span class="kw">c</span>(b1, b1[<span class="kw">length</span>(b1)] <span class="op">+</span><span class="st"> </span>update_weight[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="kw">coef</span>(lm_b1))</a>
<a class="sourceLine" id="cb28-28" data-line-number="28">  b2 &lt;-<span class="st"> </span><span class="kw">c</span>(b2, b2[<span class="kw">length</span>(b2)] <span class="op">+</span><span class="st"> </span>update_weight[<span class="dv">3</span>] <span class="op">*</span><span class="st"> </span><span class="kw">coef</span>(lm_b2))</a>
<a class="sourceLine" id="cb28-29" data-line-number="29">  component &lt;-<span class="st"> </span><span class="kw">c</span>(component, selected)</a>
<a class="sourceLine" id="cb28-30" data-line-number="30">  krit_neu &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(<span class="kw">c</span>(y <span class="op">-</span><span class="st"> </span>(b0[<span class="kw">length</span>(b0)] <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-31" data-line-number="31"><span class="st">                                 </span>b1[<span class="kw">length</span>(b1)] <span class="op">*</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-32" data-line-number="32"><span class="st">                                 </span>b2[<span class="kw">length</span>(b2)] <span class="op">*</span><span class="st"> </span>x2))<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb28-33" data-line-number="33">  krit_diff &lt;-<span class="st"> </span>krit_alt <span class="op">-</span><span class="st"> </span>krit_neu <span class="co">## Update!</span></a>
<a class="sourceLine" id="cb28-34" data-line-number="34">  krit_alt &lt;-<span class="st"> </span>krit_neu</a>
<a class="sourceLine" id="cb28-35" data-line-number="35">} <span class="co">## Ende der while-Schleife.</span></a>
<a class="sourceLine" id="cb28-36" data-line-number="36"><span class="kw">table</span>(component)</a></code></pre></div>
<pre><code>## component
##   1   2   3 
## 155  81  10</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">oma =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb30-2" data-line-number="2">    <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="fl">.4</span>, <span class="dv">0</span>), <span class="dt">tcl =</span> <span class="fl">-.3</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">paint &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">divergingx_hcl</span>(<span class="dt">n =</span> <span class="kw">length</span>(b0), <span class="dt">pal =</span> <span class="st">&quot;Zissou&quot;</span>)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">paint_a &lt;-<span class="st"> </span>colorspace<span class="op">::</span><span class="kw">divergingx_hcl</span>(<span class="dt">n =</span> <span class="kw">length</span>(b0), <span class="dt">pal =</span> <span class="st">&quot;Zissou&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="kw">plot</span>(x1, y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylim =</span> <span class="kw">range</span>(<span class="kw">c</span>(<span class="dv">0</span>, y)), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(b0)) {</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">  <span class="kw">abline</span>(<span class="dt">a =</span> b0[index], <span class="dt">b =</span> b1[index], <span class="dt">col =</span> paint_a[index])</a>
<a class="sourceLine" id="cb30-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="kw">plot</span>(x2, y, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylim =</span> <span class="kw">range</span>(<span class="kw">c</span>(<span class="dv">0</span>, y)), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="cf">for</span> (index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(b0)) {</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">  <span class="kw">abline</span>(<span class="dt">a =</span> b0[index], <span class="dt">b =</span> b2[index], <span class="dt">col =</span> paint_a[index])  </a>
<a class="sourceLine" id="cb30-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(component)), <span class="dt">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Component&quot;</span>, </a>
<a class="sourceLine" id="cb30-14" data-line-number="14">     <span class="dt">col =</span> paint, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb30-15" data-line-number="15"><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(component)), <span class="dt">labels =</span> <span class="kw">levels</span>(<span class="kw">as.factor</span>(component)), </a>
<a class="sourceLine" id="cb30-16" data-line-number="16">     <span class="dt">las =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="intro_to_R_session_03_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
<div id="apply-commands" class="section level2">
<h2><span class="header-section-number">3.5</span> <code>apply</code>-commands</h2>
<p>An <code>apply</code>-command applies the same function to each of the elements of a data object.
This is usually done for taking the sum or calculating the arithmetic mean, or quantiles, of the columns or rows of a matrix.
There are different - but actually very similar – versions of <code>appyly</code>.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">apply</span>(X, MARGIN, FUN, ...) <span class="co">## For matrix X: Result is a list.</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw">lapply</span>(X, FUN, ...) <span class="co">## For list X: Result is a list.</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw">sapply</span>(X, FUN, ...) <span class="co">## For list X: Result is a vector or another </span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co">## Data object that the result might be &#39;simplified&#39; to.</span></a></code></pre></div>
<ul>
<li><code>apply</code> applies function (specified by <code>FUN</code>) to each element of the respective dimension (defined with argument <code>MARGIN</code>) of <code>X</code>.</li>
<li><code>MARGIN</code> equals <code>1</code> for line-by-line, and <code>2</code> for column-wise execution.</li>
<li><code>...</code> for further arguments to <code>FUNCTION</code> (same for every element of<code>X</code>!).</li>
<li>For lists <code>X</code>, <code>MARGIN</code> cannot be selected because lists only have one dimension.</li>
</ul>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Exercises</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">A &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">data =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">(B &lt;-<span class="st"> </span><span class="kw">apply</span>(A, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> mean))</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">class</span>(B)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="kw">colSums</span>(A)<span class="op">/</span><span class="kw">nrow</span>(A)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="kw">apply</span>(A, <span class="dt">MAR =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> sd)</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">(B &lt;-<span class="st"> </span><span class="kw">apply</span>(A, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> summary))</a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="kw">class</span>(B)</a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="kw">dimnames</span>(B)</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="kw">apply</span>(drought, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">sum</span>(<span class="kw">is.na</span>(x))})</a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="kw">apply</span>(drought[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="kw">apply</span>(drought[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">MARGIN =</span> <span class="dv">1</span>, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="kw">apply</span>(frost, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">sum</span>(<span class="kw">is.na</span>(x))})</a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="kw">apply</span>(frost[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">7</span>)], <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="kw">lapply</span>(frost[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">7</span>)], <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb32-15" data-line-number="15"><span class="kw">sapply</span>(frost[, <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">7</span>)], <span class="dt">FUN =</span> mean)</a></code></pre></div>
</div>
</div>
<div id="plyrddply-splitapplycombine" class="section level2">
<h2><span class="header-section-number">3.6</span> <code>plyr::ddply</code>: ’split–apply–combine</h2>
<p>‘split–apply–combine’ refers to a sequence of actions that is often used in the analysis of data:</p>
<ul>
<li><em>split</em>: Split the data set according to the characteristics of one or a combination of several categorical variables,</li>
<li><em>apply</em>: Apply statistical methods (or functions like <code>mean()</code>, <code>length()</code>, …) to each of these partial data sets,</li>
<li><em>combine</em>: Manage all results in a common result object.</li>
</ul>
<p>‘split–apply–combine’ with the function <code>ddply</code> from the package <code>plyr</code> <span class="citation">(Wickham <a href="#ref-Wickham:2011">2011</a>)</span>:</p>
<ul>
<li>takes a dataframe (one of the <code>d</code>s in the functions name)</li>
<li>returns a dataframe (the second <code>d</code> in the functions name)</li>
</ul>
<p>Alternative: base R <em>aggregate</em>.</p>
<p><strong>Usage:</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;plyr&quot;</span>)</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="kw">ddply</span>(data, </a>
<a class="sourceLine" id="cb33-3" data-line-number="3">      <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;variable(s) to split data frame by&quot;</span>), </a>
<a class="sourceLine" id="cb33-4" data-line-number="4">      summarise, </a>
<a class="sourceLine" id="cb33-5" data-line-number="5">      <span class="dt">output_variable1 =</span> <span class="kw">function1</span>(input_variable1),</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">      <span class="dt">output_variable2 =</span> <span class="kw">function2</span>(input_variable2),</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">      ...)</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;plyr&quot;</span>)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">d_breaks_cut &lt;-<span class="st"> </span><span class="kw">quantile</span>(df<span class="op">$</span>d, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.05</span>))</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">df<span class="op">$</span>d_cut &lt;-<span class="st"> </span><span class="kw">cut</span>(df<span class="op">$</span>d, <span class="dt">breaks =</span> d_breaks_cut, <span class="dt">include.lowest =</span> T)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">dd &lt;-<span class="st"> </span><span class="kw">ddply</span>(df, <span class="kw">c</span>(<span class="st">&quot;d_cut&quot;</span>), summarise, </a>
<a class="sourceLine" id="cb34-5" data-line-number="5">            <span class="dt">n =</span> <span class="kw">length</span>(h),</a>
<a class="sourceLine" id="cb34-6" data-line-number="6">            <span class="dt">h_min =</span> <span class="kw">min</span>(h),</a>
<a class="sourceLine" id="cb34-7" data-line-number="7">            <span class="dt">h_q25 =</span> <span class="kw">quantile</span>(h, <span class="dt">probs =</span> <span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb34-8" data-line-number="8">            <span class="dt">h_mean =</span> <span class="kw">mean</span>(h),</a>
<a class="sourceLine" id="cb34-9" data-line-number="9">            <span class="dt">h_q75 =</span> <span class="kw">quantile</span>(h, <span class="dt">probs =</span> <span class="fl">0.75</span>),</a>
<a class="sourceLine" id="cb34-10" data-line-number="10">            <span class="dt">h_max =</span> <span class="kw">max</span>(h))</a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="kw">head</span>(dd)</a></code></pre></div>
<pre><code>##       d_cut  n h_min h_q25   h_mean h_q75 h_max
## 1 [1.5,3.1] 86   1.9 2.900 3.389535 3.800   6.8
## 2   (3.1,4] 91   2.1 3.600 4.410989 5.050   7.5
## 3   (4,4.8] 86   3.2 4.200 4.995349 5.800   7.9
## 4 (4.8,5.4] 79   3.1 4.550 5.401266 6.050  10.1
## 5 (5.4,6.2] 93   3.4 5.200 6.311828 7.100  15.5
## 6 (6.2,6.9] 74   3.8 5.125 6.532432 7.775   9.8</code></pre>
</div>
<div id="pragmatic-programming." class="section level2">
<h2><span class="header-section-number">3.7</span> Pragmatic Programming.</h2>
<p><strong>The primary aim of your R Code is that it does what you need it to do – without errors!</strong></p>
<p><strong>Faulty conclusions in your data analysis as a consequence of data handling errors are one of the worst things that can happen to you as a researcher.</strong></p>
<p><strong>Copy-paste sequences such as:</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">df[, <span class="dv">1</span>] &lt;-<span class="st"> </span>df[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df[, <span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(df[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">df[, <span class="dv">2</span>] &lt;-<span class="st"> </span>df[, <span class="dv">2</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df[, <span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(df[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">df[, <span class="dv">3</span>] &lt;-<span class="st"> </span>df[, <span class="dv">3</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df[, <span class="dv">3</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(df[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">df[, <span class="dv">5</span>] &lt;-<span class="st"> </span>df[, <span class="dv">5</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df[, <span class="dv">5</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(df[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">df[, <span class="dv">6</span>] &lt;-<span class="st"> </span>df[, <span class="dv">6</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(df[, <span class="dv">6</span>]) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(df[, <span class="dv">6</span>])</a></code></pre></div>
<p><strong>are one of the main error source for R users / ‘beginners’ that don’t rely on ‘programming techniques’.</strong></p>
<p><strong>Loops are somehow ill-reputed, but whatever way of programming you find that get’s you towards errorless handling of your data, is perfect!</strong></p>
<p>Therefore:</p>
<ul>
<li>Use loops as often as possible (‘upwards’: whereever you can replace long copy-paste chains with an errorless loop), but avoid loops as often as necessary (‘downwards’), because – very roughly said – loops read and write to the main memory in each iteration <span class="math inline">\(\rightarrow\)</span> Vectorized programming reads and writes only once: many functions take vectors as arguments and are therefore (often) faster.</li>
<li>Use an <code>apply</code> command if you want the function to do the same on every element.</li>
<li>But: Loops are simple and pragmatic and whoever masters them is already a king: It is better if R-Code gets something done slowly, but correct, than quickly, but wrong!</li>
<li>Loops cannot be avoided in an iterative processes – but this is something you will rarely need!</li>
</ul>
<p><strong>And for making R-base graphics – in especially in sampling based Bayesian statistical modeling – loops are completely ok and very often a very convenient way to get you towards your graphics.</strong></p>
<p>(<code>ggplot</code> might get you to an analogue graphic with avoiding loops!)</p>
<!-- 
- Avoiding 'if-else' is not worth it under complex conditions!
-->
<!-- 
- For clearer code:
- vectorizing conditions:

```r
drought$n_species <- sum(drought$species == "Beech") * (drought$species == "Beech") + 
  sum(drought$species == "Spruce") * (drought$species == "Spruce")
drought$n_species
drought$n_species <- NA
sum(drought$species == "Beech") * (drought$species == "Beech") + 
  sum(drought$species == "Spruce") * (drought$species == "Spruce")
drought$n_species
result <- content1 * logical_comparison1 +
  content2 * logical_comparison2 + ...
```
-->
</div>
</div>
<div id="define-your-own-functions." class="section level1">
<h1><span class="header-section-number">4</span> Define your own functions.</h1>
<p><strong>Why should I be able to define my own functions?</strong></p>
<ul>
<li>Functions generalize command sequences and make it easier and easier to try something out under many different argument values / dates / ….</li>
<li>Functions keep the workspace clean (see next section on environments).</li>
<li>Functions facilitate the reproducibility of analyzes.</li>
<li>Functions make it easier for other users to access your work.</li>
<li>As can be seen from the <code>apply()</code> examples, it is very often necessary to be able to write your own little helper functions.
Also for your own <strong>orientation</strong>: Always comment on the processes and steps in your code and in your functions to make it easier to understand the motivation and ideas behind it later.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">name &lt;-<span class="st"> </span><span class="cf">function</span>(arg1, arg2, <span class="dt">arg3 =</span> <span class="ot">TRUE</span>, <span class="dt">arg4 =</span> <span class="dv">2</span>, ...){</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  content</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">}</a></code></pre></div>
<ul>
<li>The general rules for naming objects also apply to function arguments.</li>
<li>Arguments can have preset values (here <code>arg3</code> and<code>arg4</code>)</li>
<li>The last argument <code>...</code> (optional) is a special argument and can be used to pass unspecified arguments to function calls.</li>
<li>Arguments changed by <code>content</code> and objects created are in their own local environment.</li>
<li>The result is returned to the global environment with <code>return(result)</code>.</li>
</ul>
<div id="naming-conventions-for-arguments." class="section level2">
<h2><span class="header-section-number">4.1</span> Naming conventions for arguments.</h2>
<table>
<thead>
<tr class="header">
<th align="left">Argument name</th>
<th align="left">Inhalt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>data</code></td>
<td align="left">Dataframe</td>
</tr>
<tr class="even">
<td align="left"><code>x</code>, <code>y</code>, <code>z</code></td>
<td align="left">Vectors (most often with numerical elements)</td>
</tr>
<tr class="odd">
<td align="left"><code>n</code></td>
<td align="left">Sample size</td>
</tr>
<tr class="even">
<td align="left"><code>formula</code></td>
<td align="left">Formula object</td>
</tr>
<tr class="odd">
<td align="left">…</td>
<td align="left">…</td>
</tr>
</tbody>
</table>
<ul>
<li>Use function and argument names that are based on existing R functions.</li>
<li>Make arguments as self-explanatory as possible by name.</li>
</ul>
<!--
% functions: options for function attributes}
% - functions without attributes are possible (eg. `getwd()}, `ls()})
% - attributes without default values have to be filled in
% - default values are used if attributes is not specified in the call to the function
-->
</div>
<div id="content-and-result." class="section level2">
<h2><span class="header-section-number">4.2</span> <code>content</code> and <code>result</code>.</h2>
<p><strong>The <code>content</code> block:</strong></p>
<ul>
<li>Should make it possible to carry out many similar – but different – calculations and therefore define as few objects as possible to ‘fixed values’: alternatively, always try to define arguments with default values.</li>
<li>Falls back on the higher-level environment (or environments, if necessary) if it cannot find an object in the local environment (this is known as <em>scoping</em>).</li>
</ul>
<p><strong>The <code>result</code> object:</strong></p>
<ul>
<li>Can be of any possible R object class (vector, list, data set, function (a function that itself returns a function is called <em>closure</em>), …).</li>
<li>Is generated by calling the function and stored in the global environment.</li>
<li>All other objects are no longer ‘visible’ from the global environment.</li>
</ul>
</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">4.3</span> Exercises</h2>
<div id="environments-and-scoping" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Environments and scoping</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="kw">ls</span>()</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb38-4" data-line-number="4">  y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5">  <span class="kw">print</span>(<span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">  y &lt;-<span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z <span class="co">## f will search for z in the parent (global, here) environment.</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7">  <span class="kw">print</span>(<span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  <span class="kw">return</span>(x <span class="op">+</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb38-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb38-10" data-line-number="10">x &lt;-<span class="st"> </span><span class="dv">1</span>; z &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="kw">f</span>(<span class="dt">x =</span> x) <span class="co">## f will find z:</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="co">## -&gt; although we don&#39;t explicitly use it as an argument in the local environment</span></a>
<a class="sourceLine" id="cb38-13" data-line-number="13"><span class="co">##    passed to f.</span></a>
<a class="sourceLine" id="cb38-14" data-line-number="14">y <span class="co">## We cannot fall back on y from the higher-level environment.</span></a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): Objekt &#39;y&#39; nicht gefunden</code></pre>
</div>
<div id="closure" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Closure</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">power &lt;-<span class="st"> </span><span class="cf">function</span>(exponent){</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="kw">return</span>(<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="kw">return</span>(x <span class="op">^</span><span class="st"> </span>exponent)})</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">square &lt;-<span class="st"> </span><span class="kw">power</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="kw">square</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="kw">square</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">cube &lt;-<span class="st"> </span><span class="kw">power</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="kw">cube</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="kw">cube</span>(<span class="dv">4</span>)</a></code></pre></div>
</div>
</div>
<div id="real-world-helpers" class="section level2">
<h2><span class="header-section-number">4.4</span> Real-world helpers</h2>
<div id="drop_ghosts" class="section level3">
<h3><span class="header-section-number">4.4.1</span> <code>drop_ghosts</code></h3>
<p>This function drops ghosts, ie. it removes levels of a factor variable for which the absolute frequency in the data is <span class="math inline">\(0\)</span>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">drop_ghosts &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">lev =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">is.null</span>(lev)) {</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">    <span class="kw">as.factor</span>(<span class="kw">as.character</span>(x))  </a>
<a class="sourceLine" id="cb41-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">    <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">unique</span>(x)) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(lev)) {</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">      <span class="kw">stop</span>(<span class="st">&quot;Please provide levels of correct length!&quot;</span>)  </a>
<a class="sourceLine" id="cb41-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">    <span class="kw">factor</span>(<span class="kw">as.character</span>(x), <span class="dt">levels =</span> lev)</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">}</a></code></pre></div>
<p>Validation:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">tmp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">species =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Beech&quot;</span>, <span class="st">&quot;Spruce&quot;</span>), <span class="dt">each =</span> <span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">tmp<span class="op">$</span>species</a></code></pre></div>
<pre><code>##  [1] Beech  Beech  Beech  Beech  Beech  Spruce Spruce Spruce Spruce Spruce
## Levels: Beech Spruce</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">sub &lt;-<span class="st"> </span><span class="kw">subset</span>(tmp, species <span class="op">==</span><span class="st"> &quot;Beech&quot;</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">sub<span class="op">$</span>species</a></code></pre></div>
<pre><code>## [1] Beech Beech Beech Beech Beech
## Levels: Beech Spruce</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">drop_ghosts</span>(<span class="dt">x =</span> sub<span class="op">$</span>species)</a></code></pre></div>
<pre><code>## [1] Beech Beech Beech Beech Beech
## Levels: Beech</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">drop_ghosts</span>(<span class="dt">x =</span> sub<span class="op">$</span>species, <span class="dt">lev =</span> <span class="kw">c</span>(<span class="st">&quot;Beech&quot;</span>, <span class="st">&quot;Oak&quot;</span>))</a></code></pre></div>
<pre><code>## Error in drop_ghosts(x = sub$species, lev = c(&quot;Beech&quot;, &quot;Oak&quot;)): Please provide levels of correct length!</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">(tmp &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Beech&quot;</span>, <span class="st">&quot;Oak&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Beech&quot;</span>, <span class="st">&quot;Oak&quot;</span>, <span class="st">&quot;Spruce&quot;</span>)))</a></code></pre></div>
<pre><code>## [1] Beech Oak  
## Levels: Beech Oak Spruce</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">drop_ghosts</span>(<span class="dt">x =</span> tmp, <span class="dt">lev =</span> <span class="kw">c</span>(<span class="st">&quot;Beech&quot;</span>, <span class="st">&quot;Oak&quot;</span>))</a></code></pre></div>
<pre><code>## [1] Beech Oak  
## Levels: Beech Oak</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">drop_ghosts</span>(<span class="dt">x =</span> tmp, <span class="dt">lev =</span> <span class="kw">c</span>(<span class="st">&quot;Oak&quot;</span>, <span class="st">&quot;Beech&quot;</span>))</a></code></pre></div>
<pre><code>## [1] Beech Oak  
## Levels: Oak Beech</code></pre>
</div>
<div id="overlap_seq" class="section level3">
<h3><span class="header-section-number">4.4.2</span> <code>overlap_seq</code></h3>
<p>This function generates an overlapping sequence, ie. it takes a numeric variable <code>x</code> and a numeric step-length <code>delta</code> and calculates a sequence at multiples of <code>delta</code> that has a minimum below or just at the minumum of <code>x</code>, and a maximum beyond or just at the maximum of <code>x</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">overlap_seq &lt;-<span class="st"> </span><span class="cf">function</span>(x, delta) {</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">  tmp &lt;-<span class="st"> </span>x <span class="op">%/%</span><span class="st"> </span>delta</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">  tmp2 &lt;-<span class="st"> </span>x <span class="op">%%</span><span class="st"> </span>delta</a>
<a class="sourceLine" id="cb56-4" data-line-number="4">  <span class="cf">if</span> (tmp2[<span class="kw">which.max</span>(x)] <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb56-5" data-line-number="5">    result &lt;-<span class="st"> </span>delta <span class="op">*</span><span class="st"> </span>(<span class="kw">min</span>(tmp, <span class="dt">na.rm =</span> T)<span class="op">:</span><span class="kw">max</span>(tmp, <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb56-7" data-line-number="7">    result &lt;-<span class="st"> </span>delta <span class="op">*</span><span class="st"> </span>(<span class="kw">min</span>(tmp, <span class="dt">na.rm =</span> T)<span class="op">:</span>(<span class="kw">max</span>(tmp, <span class="dt">na.rm =</span> T) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb56-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb56-9" data-line-number="9">  <span class="kw">return</span>(result)</a>
<a class="sourceLine" id="cb56-10" data-line-number="10">}</a></code></pre></div>
<p>Validation:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">overlap_seq</span>(<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">120</span>, <span class="dv">290</span>), <span class="dt">delta =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## [1]   0 100 200 300</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">overlap_seq</span>(<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">120</span>, <span class="dv">300</span>), <span class="dt">delta =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## [1]   0 100 200 300</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw">overlap_seq</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">120</span>, <span class="dv">300</span>), <span class="dt">delta =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## [1]   0 100 200 300</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">overlap_seq</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">120</span>, <span class="dv">301</span>), <span class="dt">delta =</span> <span class="dv">100</span>)</a></code></pre></div>
<pre><code>## [1] -100    0  100  200  300  400</code></pre>
<!--
%functions: recursions}
%\begin{Verbatim}
%fibonacci <- function(n){
%  if(n == 1)
%    return(0)
%  else if(n == 2)
%    return(1)
%  else
%    return(fibonacci(n-1) + fibonacci(n-2))
%}
%\end{Verbatim}
%
%- call the function from within, define break point
%- easy for small tasks, memory intensive for large data
% functions: numerical minimization}
%\begin{Verbatim}
%goal <- function(par,...){
%  CONTENT
%  return(value)
%}
%nlm(par,goal,...)
%\end{Verbatim}
%
%- find parameter of function that produces lowest value of goal function
%- alternative: `optim}
%- if parameter constrained to interval, use: `optimize}
%- uses grid search to find minimum
%- use to find: optimal smoothing parameter, maximum likelihood, etc.

%% 
%functions: finding and handling errors}
%
%\begin{tabular}{r|l}
%Code & Function \\ \hline
%`traceback} & shows subroutine and line where error occurred \\
%`browser} & halts function and opens interactive console \\
%`debug} & execute function completely in browser mode \\
%`try} & wraps a part of code that is likely to produce errors \\
%\end{tabular}
%
%- missing brackets or syntax errors are reported while reading the function
%- the more complex the function the less obvious is any fail
%- if an analysis takes longer, multiple attempts on solving a problem are not efficient anymore
%- otherwise insert 'print' of object that might contain error
%
-->
<!--


# References {-}
-->
<div id="refs" class="references">
<div id="ref-Wickham:2011">
<p>Wickham, Hadley. 2011. “The Split-Apply-Combine Strategy for Data Analysis.” <em>Journal of Statistical Software</em> 40 (1): 1–29. <a href="http://www.jstatsoft.org/v40/i01/">http://www.jstatsoft.org/v40/i01/</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Private webpage: <a href="https://uncertaintree.github.io">uncertaintree.github.io</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": false,
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["intro_to_R_session_03.pdf", "PDF"]],
"toc": {
"collapse": "subsubsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": false,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
